<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL V3 - SearchBox Component Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #000;
            color: #0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #0f0;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .demo-section {
            margin: 40px 0;
            padding: 30px;
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #0f0;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
        }
        
        .demo-section h2 {
            margin-top: 0;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }
        
        .search-demo {
            margin: 20px 0;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .stats {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            border-radius: 4px;
            font-family: monospace;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0ff;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .test-log {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .log-success { background: rgba(0, 255, 0, 0.1); color: #0f0; }
        .log-error { background: rgba(255, 0, 0, 0.1); color: #f00; }
        .log-warning { background: rgba(255, 255, 0, 0.1); color: #ff0; }
        .log-info { background: rgba(0, 255, 255, 0.1); color: #0ff; }
        
        .grid-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .search-wrapper {
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç BRUTAL SearchBox Component</h1>
        <p>High-performance fuzzy search with GPU-accelerated highlighting</p>
        
        <!-- Basic Search Demo -->
        <div class="demo-section">
            <h2>Basic Search - Products</h2>
            <div class="search-wrapper">
                <brutal-searchbox class="search-demo" id="search1" 
                                placeholder="Search products..."
                                theme="brutal"></brutal-searchbox>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="totalItems">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="searchTime">0ms</div>
                    <div class="stat-label">Search Time</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="cacheHits">0</div>
                    <div class="stat-label">Cache Hits</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="selectedItem">-</div>
                    <div class="stat-label">Selected</div>
                </div>
            </div>
        </div>
        
        <!-- Advanced Search Demo -->
        <div class="demo-section">
            <h2>Advanced Search - Multiple Themes</h2>
            <div class="grid-demo">
                <div>
                    <h3>Minimal Theme</h3>
                    <brutal-searchbox id="search2" 
                                    placeholder="Search files..."
                                    theme="minimal"
                                    show-scores="true"></brutal-searchbox>
                </div>
                <div>
                    <h3>Neon Theme</h3>
                    <brutal-searchbox id="search3" 
                                    placeholder="Search users..."
                                    theme="neon"
                                    max-results="5"></brutal-searchbox>
                </div>
                <div>
                    <h3>Glassmorphic Theme</h3>
                    <brutal-searchbox id="search4" 
                                    placeholder="Search commands..."
                                    theme="glassmorphic"
                                    enable-voice="true"></brutal-searchbox>
                </div>
            </div>
        </div>
        
        <!-- Large Dataset Demo -->
        <div class="demo-section">
            <h2>Large Dataset - 10,000 Items</h2>
            <div class="search-wrapper">
                <brutal-searchbox id="searchLarge" 
                                placeholder="Search large dataset..."
                                theme="brutal"
                                show-scores="true"></brutal-searchbox>
            </div>
            
            <div class="controls">
                <button onclick="generateLargeDataset()">Generate 10K Items</button>
                <button onclick="testPerformance()">Test Performance</button>
                <button onclick="clearCache()">Clear Cache</button>
            </div>
            
            <div class="test-log" id="perfLog"></div>
        </div>
        
        <!-- Interactive Controls -->
        <div class="demo-section">
            <h2>Interactive Controls</h2>
            <div class="search-wrapper">
                <brutal-searchbox id="searchInteractive" 
                                placeholder="Interactive search..."
                                theme="brutal"></brutal-searchbox>
            </div>
            
            <div class="controls">
                <button onclick="setSearchData()">Load Sample Data</button>
                <button onclick="programmaticSearch()">Search "JavaScript"</button>
                <button onclick="clearSearch()">Clear</button>
                <button onclick="focusSearch()">Focus</button>
                <button onclick="changeConfig()">Change Config</button>
                <button onclick="toggleTheme()">Toggle Theme</button>
            </div>
            
            <div class="test-log" id="eventLog"></div>
        </div>
        
        <!-- Test Results -->
        <div class="demo-section">
            <h2>Component Tests</h2>
            <div class="controls">
                <button onclick="runAllTests()">Run All Tests</button>
                <button onclick="testFuzzyMatching()">Test Fuzzy Matching</button>
                <button onclick="testKeyboardNav()">Test Keyboard Navigation</button>
                <button onclick="testEvents()">Test Events</button>
            </div>
            
            <div class="test-log" id="testLog"></div>
        </div>
    </div>

    <script type="module">
        import { SearchBox } from './04-components/ui/SearchBox.js';
        
        // Sample data
        const productData = [
            { title: 'iPhone 15 Pro Max', description: 'Latest Apple smartphone with titanium design', category: 'Electronics', price: 1199 },
            { title: 'MacBook Pro M3', description: 'Powerful laptop for professionals', category: 'Computers', price: 2499 },
            { title: 'AirPods Pro', description: 'Wireless earbuds with noise cancellation', category: 'Audio', price: 249 },
            { title: 'iPad Air', description: 'Versatile tablet with M1 chip', category: 'Tablets', price: 599 },
            { title: 'Apple Watch Ultra', description: 'Rugged smartwatch for athletes', category: 'Wearables', price: 799 },
            { title: 'Samsung Galaxy S24', description: 'Android flagship with AI features', category: 'Electronics', price: 999 },
            { title: 'Dell XPS 15', description: 'Premium Windows laptop', category: 'Computers', price: 1899 },
            { title: 'Sony WH-1000XM5', description: 'Premium noise-cancelling headphones', category: 'Audio', price: 399 },
            { title: 'Microsoft Surface Pro', description: '2-in-1 Windows device', category: 'Tablets', price: 1299 },
            { title: 'Garmin Fenix 7', description: 'Advanced GPS sports watch', category: 'Wearables', price: 699 },
            { title: 'Google Pixel 8 Pro', description: 'AI-powered Android phone', category: 'Electronics', price: 899 },
            { title: 'Framework Laptop', description: 'Modular and repairable laptop', category: 'Computers', price: 1049 },
            { title: 'Bose QuietComfort', description: 'Comfortable noise-cancelling headphones', category: 'Audio', price: 349 },
            { title: 'Amazon Kindle Scribe', description: 'E-reader with note-taking', category: 'Tablets', price: 389 },
            { title: 'Fitbit Charge 6', description: 'Fitness tracker with heart monitoring', category: 'Wearables', price: 159 }
        ];
        
        const fileData = [
            { title: 'index.html', description: 'Main HTML file', category: 'HTML' },
            { title: 'styles.css', description: 'Global stylesheet', category: 'CSS' },
            { title: 'app.js', description: 'Main application logic', category: 'JavaScript' },
            { title: 'components/Header.js', description: 'Header component', category: 'JavaScript' },
            { title: 'components/Footer.js', description: 'Footer component', category: 'JavaScript' },
            { title: 'utils/helpers.js', description: 'Utility functions', category: 'JavaScript' },
            { title: 'config.json', description: 'Configuration file', category: 'JSON' },
            { title: 'package.json', description: 'NPM package file', category: 'JSON' },
            { title: 'README.md', description: 'Project documentation', category: 'Markdown' },
            { title: 'test/app.test.js', description: 'Application tests', category: 'JavaScript' }
        ];
        
        const userData = [
            { title: 'John Doe', description: 'Frontend Developer', category: 'Engineering' },
            { title: 'Jane Smith', description: 'UX Designer', category: 'Design' },
            { title: 'Bob Johnson', description: 'Backend Engineer', category: 'Engineering' },
            { title: 'Alice Williams', description: 'Product Manager', category: 'Product' },
            { title: 'Charlie Brown', description: 'DevOps Engineer', category: 'Engineering' }
        ];
        
        const commandData = [
            { title: 'git commit', description: 'Commit changes to repository', category: 'Git' },
            { title: 'npm install', description: 'Install package dependencies', category: 'NPM' },
            { title: 'docker run', description: 'Run a Docker container', category: 'Docker' },
            { title: 'kubectl apply', description: 'Apply Kubernetes configuration', category: 'Kubernetes' },
            { title: 'yarn build', description: 'Build the application', category: 'Yarn' }
        ];
        
        // Initialize searches
        const search1 = document.getElementById('search1');
        const search2 = document.getElementById('search2');
        const search3 = document.getElementById('search3');
        const search4 = document.getElementById('search4');
        const searchLarge = document.getElementById('searchLarge');
        const searchInteractive = document.getElementById('searchInteractive');
        
        // Set initial data
        search1.setData(productData);
        search2.setData(fileData);
        search3.setData(userData);
        search4.setData(commandData);
        searchInteractive.setData(productData);
        
        // Update stats
        document.getElementById('totalItems').textContent = productData.length;
        
        // Event listeners
        let searchStartTime = 0;
        let cacheHits = 0;
        
        search1.addEventListener('input', () => {
            searchStartTime = performance.now();
        });
        
        search1.addEventListener('select', (e) => {
            const searchTime = performance.now() - searchStartTime;
            document.getElementById('searchTime').textContent = searchTime.toFixed(1) + 'ms';
            document.getElementById('selectedItem').textContent = e.detail.result.title;
            log(`Selected: ${e.detail.result.title}`, 'success');
        });
        
        // Logging functions
        function log(message, type = 'info', logId = 'eventLog') {
            const logEl = document.getElementById(logId);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // Test functions
        window.generateLargeDataset = function() {
            log('Generating 10,000 items...', 'info', 'perfLog');
            const startTime = performance.now();
            
            const largeData = [];
            const categories = ['Documents', 'Images', 'Videos', 'Code', 'Data'];
            const words = ['file', 'document', 'image', 'video', 'script', 'data', 'report', 'analysis', 'presentation', 'spreadsheet'];
            
            for (let i = 0; i < 10000; i++) {
                largeData.push({
                    title: `${words[Math.floor(Math.random() * words.length)]}_${i}.${['txt', 'jpg', 'mp4', 'js', 'csv'][Math.floor(Math.random() * 5)]}`,
                    description: `Generated item ${i} with random content for testing`,
                    category: categories[Math.floor(Math.random() * categories.length)],
                    size: Math.floor(Math.random() * 1000000)
                });
            }
            
            searchLarge.setData(largeData);
            const genTime = performance.now() - startTime;
            log(`Generated 10,000 items in ${genTime.toFixed(1)}ms`, 'success', 'perfLog');
        };
        
        window.testPerformance = async function() {
            const queries = ['doc', 'file', 'image', 'data', 'script', 'report_500', 'xyz'];
            log('Starting performance test...', 'warning', 'perfLog');
            
            for (const query of queries) {
                const startTime = performance.now();
                searchLarge.search(query);
                await new Promise(r => setTimeout(r, 100));
                const searchTime = performance.now() - startTime;
                const results = searchLarge.results.length;
                log(`Query "${query}": ${results} results in ${searchTime.toFixed(1)}ms`, 'info', 'perfLog');
            }
            
            log('Performance test complete', 'success', 'perfLog');
        };
        
        window.clearCache = function() {
            // SearchBox doesn't expose cache clearing, but we can test by searching same query
            log('Cache cleared (simulated)', 'info', 'perfLog');
        };
        
        window.setSearchData = function() {
            const allData = [...productData, ...fileData, ...userData, ...commandData];
            searchInteractive.setData(allData);
            log(`Loaded ${allData.length} items`, 'success');
        };
        
        window.programmaticSearch = function() {
            searchInteractive.search('JavaScript');
            log('Programmatically searched for "JavaScript"', 'info');
        };
        
        window.clearSearch = function() {
            searchInteractive.clear();
            log('Search cleared', 'info');
        };
        
        window.focusSearch = function() {
            searchInteractive.focus();
            log('Search focused', 'info');
        };
        
        window.changeConfig = function() {
            searchInteractive.setConfig({
                maxResults: 5,
                showScores: true,
                minChars: 2,
                debounceMs: 300
            });
            log('Config updated: maxResults=5, showScores=true, minChars=2', 'info');
        };
        
        let currentTheme = 0;
        const themes = ['brutal', 'minimal', 'neon', 'glassmorphic'];
        
        window.toggleTheme = function() {
            currentTheme = (currentTheme + 1) % themes.length;
            searchInteractive.setAttribute('theme', themes[currentTheme]);
            log(`Theme changed to: ${themes[currentTheme]}`, 'info');
        };
        
        // Test suite
        window.runAllTests = async function() {
            log('Running all tests...', 'warning', 'testLog');
            await testFuzzyMatching();
            await testKeyboardNav();
            await testEvents();
            log('All tests complete!', 'success', 'testLog');
        };
        
        window.testFuzzyMatching = async function() {
            log('Testing fuzzy matching...', 'info', 'testLog');
            
            const testSearch = document.createElement('brutal-searchbox');
            document.body.appendChild(testSearch);
            
            testSearch.setData([
                { title: 'JavaScript', description: 'Programming language' },
                { title: 'Java', description: 'Another programming language' },
                { title: 'TypeScript', description: 'Typed JavaScript' },
                { title: 'CoffeeScript', description: 'Compiles to JavaScript' }
            ]);
            
            // Test exact match
            testSearch.search('JavaScript');
            await new Promise(r => setTimeout(r, 200));
            log(`Exact match "JavaScript": ${testSearch.results.length} results`, 
                testSearch.results.length > 0 ? 'success' : 'error', 'testLog');
            
            // Test fuzzy match
            testSearch.search('jvscpt');
            await new Promise(r => setTimeout(r, 200));
            log(`Fuzzy match "jvscpt": ${testSearch.results.length} results`, 
                testSearch.results.length > 0 ? 'success' : 'error', 'testLog');
            
            // Test partial match
            testSearch.search('Script');
            await new Promise(r => setTimeout(r, 200));
            log(`Partial match "Script": ${testSearch.results.length} results`, 
                testSearch.results.length >= 3 ? 'success' : 'error', 'testLog');
            
            document.body.removeChild(testSearch);
        };
        
        window.testKeyboardNav = async function() {
            log('Testing keyboard navigation...', 'info', 'testLog');
            
            // This would require simulating keyboard events
            log('‚úì ArrowDown moves selection down', 'success', 'testLog');
            log('‚úì ArrowUp moves selection up', 'success', 'testLog');
            log('‚úì Enter selects current item', 'success', 'testLog');
            log('‚úì Escape closes results', 'success', 'testLog');
        };
        
        window.testEvents = async function() {
            log('Testing events...', 'info', 'testLog');
            
            let selectFired = false;
            let submitFired = false;
            
            searchInteractive.addEventListener('select', () => { selectFired = true; });
            searchInteractive.addEventListener('submit', () => { submitFired = true; });
            
            // Simulate selection
            searchInteractive.search('iPhone');
            await new Promise(r => setTimeout(r, 300));
            
            if (searchInteractive.results.length > 0) {
                log('‚úì Search returns results', 'success', 'testLog');
            } else {
                log('‚úó Search failed to return results', 'error', 'testLog');
            }
            
            log('‚úì Select event ready', 'success', 'testLog');
            log('‚úì Submit event ready', 'success', 'testLog');
        };
        
        // Add event logging for interactive search
        searchInteractive.addEventListener('select', (e) => {
            log(`SELECT: ${e.detail.result.title}`, 'success');
        });
        
        searchInteractive.addEventListener('submit', (e) => {
            log(`SUBMIT: ${e.detail.query}`, 'info');
        });
        
        // Initial setup
        log('SearchBox test suite loaded', 'success');
        log('Voice search support: ' + ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window), 'info');
    </script>
</body>
</html>