<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL V3 - TabPanel Comprehensive Test Suite</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui;
            background: #000;
            color: #0f0;
        }
        
        .test-container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #0f0, #0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-shadow: 0 0 30px #0f0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #0f0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .test-card:hover {
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }
        
        button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0;
        }
        
        .test-output {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .log-success { background: rgba(0, 255, 0, 0.1); color: #0f0; }
        .log-error { background: rgba(255, 0, 0, 0.1); color: #f00; }
        .log-warning { background: rgba(255, 255, 0, 0.1); color: #ff0; }
        .log-info { background: rgba(0, 255, 255, 0.1); color: #0ff; }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background: #666;
        }
        
        .status-indicator.pass { background: #0f0; box-shadow: 0 0 10px #0f0; }
        .status-indicator.fail { background: #f00; box-shadow: 0 0 10px #f00; }
        .status-indicator.running { 
            background: #ff0; 
            box-shadow: 0 0 10px #ff0;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .test-summary {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        
        .test-summary.fail {
            background: rgba(255, 0, 0, 0.1);
            border-color: #f00;
        }
        
        .test-area {
            margin: 20px 0;
            min-height: 300px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>BRUTAL V3 - TabPanel Component Test Suite</h1>
        <p>Comprehensive testing for lazy-loading tab system</p>
        
        <div class="test-summary" id="testSummary">
            <h2>Test Summary</h2>
            <div>Total Tests: <span id="totalTests">0</span></div>
            <div>Passed: <span id="passedTests" style="color: #0f0;">0</span></div>
            <div>Failed: <span id="failedTests" style="color: #f00;">0</span></div>
            <div>Status: <span id="testStatus">Not Started</span></div>
        </div>
        
        <div class="test-grid">
            <!-- Test 1: Basic Initialization -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status1"></span>Basic Initialization</h3>
                <p>Tests component creation and shadow DOM setup</p>
                <button onclick="runTest1()">Run Test</button>
                <div id="result1"></div>
            </div>
            
            <!-- Test 2: Tab Management -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status2"></span>Tab Management</h3>
                <p>Tests add, remove, and activate tabs</p>
                <button onclick="runTest2()">Run Test</button>
                <div id="result2"></div>
            </div>
            
            <!-- Test 3: Lazy Loading -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status3"></span>Lazy Loading</h3>
                <p>Tests lazy content loading</p>
                <button onclick="runTest3()">Run Test</button>
                <div id="result3"></div>
            </div>
            
            <!-- Test 4: Keyboard Navigation -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status4"></span>Keyboard Navigation</h3>
                <p>Tests arrow keys and tab navigation</p>
                <button onclick="runTest4()">Run Test</button>
                <div id="result4"></div>
            </div>
            
            <!-- Test 5: Closeable Tabs -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status5"></span>Closeable Tabs</h3>
                <p>Tests tab closing functionality</p>
                <button onclick="runTest5()">Run Test</button>
                <div id="result5"></div>
            </div>
            
            <!-- Test 6: Drag and Drop -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status6"></span>Drag and Drop</h3>
                <p>Tests tab reordering</p>
                <button onclick="runTest6()">Run Test</button>
                <div id="result6"></div>
            </div>
            
            <!-- Test 7: Themes -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status7"></span>Theme System</h3>
                <p>Tests all theme variations</p>
                <button onclick="runTest7()">Run Test</button>
                <div id="result7"></div>
            </div>
            
            <!-- Test 8: Animations -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status8"></span>Animation Types</h3>
                <p>Tests all animation modes</p>
                <button onclick="runTest8()">Run Test</button>
                <div id="result8"></div>
            </div>
            
            <!-- Test 9: Overflow Handling -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status9"></span>Overflow Handling</h3>
                <p>Tests scroll and dropdown overflow</p>
                <button onclick="runTest9()">Run Test</button>
                <div id="result9"></div>
            </div>
            
            <!-- Test 10: Events -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status10"></span>Event System</h3>
                <p>Tests all event emissions</p>
                <button onclick="runTest10()">Run Test</button>
                <div id="result10"></div>
            </div>
            
            <!-- Test 11: Performance -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status11"></span>Performance</h3>
                <p>Tests with many tabs</p>
                <button onclick="runTest11()">Run Test</button>
                <div id="result11"></div>
            </div>
            
            <!-- Test 12: Edge Cases -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status12"></span>Edge Cases</h3>
                <p>Tests error handling and limits</p>
                <button onclick="runTest12()">Run Test</button>
                <div id="result12"></div>
            </div>
        </div>
        
        <div style="margin: 40px 0;">
            <button onclick="runAllTests()" style="font-size: 1.2rem; padding: 15px 30px;">
                Run All Tests
            </button>
            <button onclick="clearResults()" style="font-size: 1.2rem; padding: 15px 30px;">
                Clear Results
            </button>
        </div>
        
        <h2>Test Output</h2>
        <div class="test-output" id="testOutput"></div>
        
        <!-- Test area for components -->
        <div class="test-area" id="testArea"></div>
    </div>

    <script type="module">
        import { TabPanel } from './04-components/ui/TabPanel.js';
        
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        
        function log(message, type = 'info') {
            const output = document.getElementById('testOutput');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
        }
        
        function updateSummary() {
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('passedTests').textContent = passedTests;
            document.getElementById('failedTests').textContent = failedTests;
            
            const status = totalTests === 0 ? 'Not Started' :
                          failedTests === 0 ? 'All Passed ✓' :
                          'Some Failed ✗';
            document.getElementById('testStatus').textContent = status;
            
            const summary = document.getElementById('testSummary');
            summary.className = failedTests > 0 ? 'test-summary fail' : 'test-summary';
        }
        
        function setTestStatus(testId, status) {
            const indicator = document.getElementById(`status${testId}`);
            indicator.className = `status-indicator ${status}`;
        }
        
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message);
            }
        }
        
        // Test 1: Basic Initialization
        window.runTest1 = async function() {
            totalTests++;
            setTestStatus(1, 'running');
            const resultEl = document.getElementById('result1');
            
            try {
                log('Test 1: Basic Initialization - Starting', 'info');
                
                // Create tabpanel element
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Wait for initialization
                await new Promise(r => setTimeout(r, 100));
                
                // Verify basic setup
                assert(tabPanel instanceof TabPanel, 'Not a TabPanel instance');
                assert(tabPanel.shadowRoot, 'Shadow DOM not created');
                
                // Check template rendering
                const container = tabPanel.shadowRoot.querySelector('.tabpanel-container');
                assert(container, 'Container not found');
                
                const tabsWrapper = tabPanel.shadowRoot.querySelector('.tabs-wrapper');
                assert(tabsWrapper, 'Tabs wrapper not found');
                
                const panelsWrapper = tabPanel.shadowRoot.querySelector('.panels-wrapper');
                assert(panelsWrapper, 'Panels wrapper not found');
                
                // Check initial state
                assert(Array.isArray(tabPanel._tabs), 'Tabs array not initialized');
                assert(tabPanel._tabs.length === 0, 'Tabs not empty initially');
                
                // Check config
                assert(tabPanel._config, 'Config not initialized');
                assert(tabPanel._config.orientation === 'horizontal', 'Default orientation incorrect');
                assert(tabPanel._config.lazy === true, 'Default lazy loading incorrect');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(1, 'pass');
                passedTests++;
                log('Test 1: Passed - TabPanel initializes correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(1, 'fail');
                failedTests++;
                log(`Test 1: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 2: Tab Management
        window.runTest2 = async function() {
            totalTests++;
            setTestStatus(2, 'running');
            const resultEl = document.getElementById('result2');
            
            try {
                log('Test 2: Tab Management - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                await new Promise(r => setTimeout(r, 100));
                
                // Test adding tabs
                tabPanel.addTab({
                    id: 'tab1',
                    label: 'Tab 1',
                    content: 'Content 1'
                });
                
                assert(tabPanel._tabs.length === 1, 'Tab not added');
                assert(tabPanel._activeTab === 'tab1', 'First tab not activated');
                
                await new Promise(r => setTimeout(r, 100));
                
                // Check DOM
                const tab1El = tabPanel.shadowRoot.querySelector('[data-tab-id="tab1"]');
                assert(tab1El, 'Tab element not rendered');
                assert(tab1El.classList.contains('active'), 'Tab not marked active');
                
                const panel1El = tabPanel.shadowRoot.querySelector('#panel-tab1');
                assert(panel1El, 'Panel element not rendered');
                assert(panel1El.classList.contains('active'), 'Panel not marked active');
                
                // Add more tabs
                tabPanel.addTab({ id: 'tab2', label: 'Tab 2', content: 'Content 2' });
                tabPanel.addTab({ id: 'tab3', label: 'Tab 3', content: 'Content 3' });
                
                assert(tabPanel._tabs.length === 3, 'Additional tabs not added');
                
                // Test activation
                tabPanel.activateTab('tab2');
                await new Promise(r => setTimeout(r, 100));
                
                assert(tabPanel._activeTab === 'tab2', 'Tab not activated');
                const tab2El = tabPanel.shadowRoot.querySelector('[data-tab-id="tab2"]');
                assert(tab2El.classList.contains('active'), 'Active class not applied');
                
                // Test removal
                tabPanel.removeTab('tab2');
                await new Promise(r => setTimeout(r, 100));
                
                assert(tabPanel._tabs.length === 2, 'Tab not removed');
                assert(tabPanel._activeTab !== 'tab2', 'Removed tab still active');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(2, 'pass');
                passedTests++;
                log('Test 2: Passed - Tab management working correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(2, 'fail');
                failedTests++;
                log(`Test 2: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 3: Lazy Loading
        window.runTest3 = async function() {
            totalTests++;
            setTestStatus(3, 'running');
            const resultEl = document.getElementById('result3');
            
            try {
                log('Test 3: Lazy Loading - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                tabPanel.setConfig({ lazy: true });
                document.getElementById('testArea').appendChild(tabPanel);
                await new Promise(r => setTimeout(r, 100));
                
                let loaderCalled = false;
                
                // Add tab with loader
                tabPanel.addTab({
                    id: 'lazy1',
                    label: 'Lazy Tab',
                    loader: async () => {
                        loaderCalled = true;
                        await new Promise(r => setTimeout(r, 100));
                        return '<div>Lazy loaded content!</div>';
                    }
                });
                
                // Add regular tab
                tabPanel.addTab({
                    id: 'regular',
                    label: 'Regular Tab',
                    content: 'Regular content',
                    active: true
                });
                
                await new Promise(r => setTimeout(r, 100));
                
                // Loader should not be called yet
                assert(!loaderCalled, 'Loader called before activation');
                assert(!tabPanel._loadedTabs.has('lazy1'), 'Tab marked as loaded prematurely');
                
                // Activate lazy tab
                tabPanel.activateTab('lazy1');
                await new Promise(r => setTimeout(r, 300));
                
                // Loader should be called now
                assert(loaderCalled, 'Loader not called on activation');
                assert(tabPanel._loadedTabs.has('lazy1'), 'Tab not marked as loaded');
                assert(tabPanel._tabContent.has('lazy1'), 'Content not stored');
                
                // Check rendered content
                const panel = tabPanel.shadowRoot.querySelector('#panel-lazy1');
                assert(panel.textContent.includes('Lazy loaded content'), 'Lazy content not rendered');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(3, 'pass');
                passedTests++;
                log('Test 3: Passed - Lazy loading working correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(3, 'fail');
                failedTests++;
                log(`Test 3: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 4: Keyboard Navigation
        window.runTest4 = async function() {
            totalTests++;
            setTestStatus(4, 'running');
            const resultEl = document.getElementById('result4');
            
            try {
                log('Test 4: Keyboard Navigation - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Add tabs
                tabPanel.addTab({ id: 'nav1', label: 'Nav 1', content: 'Content 1' });
                tabPanel.addTab({ id: 'nav2', label: 'Nav 2', content: 'Content 2' });
                tabPanel.addTab({ id: 'nav3', label: 'Nav 3', content: 'Content 3' });
                
                await new Promise(r => setTimeout(r, 100));
                
                const tabsList = tabPanel.shadowRoot.querySelector('.tabs-list');
                const firstTab = tabPanel.shadowRoot.querySelector('[data-tab-id="nav1"]');
                
                // Focus first tab
                firstTab.focus();
                
                // Test ArrowRight
                const rightEvent = new KeyboardEvent('keydown', { key: 'ArrowRight', bubbles: true });
                tabsList.dispatchEvent(rightEvent);
                
                await new Promise(r => setTimeout(r, 100));
                
                const focusedTab = tabPanel.shadowRoot.activeElement?.closest('.tab');
                assert(focusedTab && focusedTab.dataset.tabId === 'nav2', 'ArrowRight navigation failed');
                
                // Test Home key
                const homeEvent = new KeyboardEvent('keydown', { key: 'Home', bubbles: true });
                tabsList.dispatchEvent(homeEvent);
                
                await new Promise(r => setTimeout(r, 100));
                
                const homeFocused = tabPanel.shadowRoot.activeElement?.closest('.tab');
                assert(homeFocused && homeFocused.dataset.tabId === 'nav1', 'Home key navigation failed');
                
                // Test Enter activation
                const enterEvent = new KeyboardEvent('keydown', { key: 'Enter', bubbles: true });
                tabsList.dispatchEvent(enterEvent);
                
                await new Promise(r => setTimeout(r, 100));
                assert(tabPanel._activeTab === 'nav1', 'Enter key activation failed');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(4, 'pass');
                passedTests++;
                log('Test 4: Passed - Keyboard navigation working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(4, 'fail');
                failedTests++;
                log(`Test 4: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 5: Closeable Tabs
        window.runTest5 = async function() {
            totalTests++;
            setTestStatus(5, 'running');
            const resultEl = document.getElementById('result5');
            
            try {
                log('Test 5: Closeable Tabs - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                tabPanel.setConfig({ closeable: true });
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Add tabs
                tabPanel.addTab({ id: 'close1', label: 'Closeable 1', content: 'Content 1' });
                tabPanel.addTab({ id: 'close2', label: 'Closeable 2', content: 'Content 2' });
                tabPanel.addTab({ 
                    id: 'notCloseable', 
                    label: 'Not Closeable', 
                    content: 'Cannot close',
                    closeable: false 
                });
                
                await new Promise(r => setTimeout(r, 100));
                
                // Check close buttons
                const close1Btn = tabPanel.shadowRoot.querySelector('[data-tab-id="close1"] .tab-close');
                assert(close1Btn, 'Close button not rendered for closeable tab');
                
                const notCloseableBtn = tabPanel.shadowRoot.querySelector('[data-tab-id="notCloseable"] .tab-close');
                assert(!notCloseableBtn, 'Close button rendered for non-closeable tab');
                
                // Test closing
                const initialCount = tabPanel._tabs.length;
                tabPanel.closeTab('close1');
                
                await new Promise(r => setTimeout(r, 100));
                
                assert(tabPanel._tabs.length === initialCount - 1, 'Tab not closed');
                assert(!tabPanel._tabs.find(t => t.id === 'close1'), 'Closed tab still in array');
                
                // Try closing non-closeable
                tabPanel.closeTab('notCloseable');
                await new Promise(r => setTimeout(r, 100));
                
                assert(tabPanel._tabs.find(t => t.id === 'notCloseable'), 'Non-closeable tab was closed');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(5, 'pass');
                passedTests++;
                log('Test 5: Passed - Closeable tabs working correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(5, 'fail');
                failedTests++;
                log(`Test 5: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 6: Drag and Drop
        window.runTest6 = async function() {
            totalTests++;
            setTestStatus(6, 'running');
            const resultEl = document.getElementById('result6');
            
            try {
                log('Test 6: Drag and Drop - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                tabPanel.setConfig({ draggable: true });
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Add tabs
                tabPanel.addTab({ id: 'drag1', label: 'Drag 1', content: 'Content 1' });
                tabPanel.addTab({ id: 'drag2', label: 'Drag 2', content: 'Content 2' });
                tabPanel.addTab({ id: 'drag3', label: 'Drag 3', content: 'Content 3' });
                
                await new Promise(r => setTimeout(r, 100));
                
                // Check draggable attribute
                const tab1 = tabPanel.shadowRoot.querySelector('[data-tab-id="drag1"]');
                assert(tab1.getAttribute('draggable') === 'true', 'Tab not draggable');
                
                // Get initial order
                const initialOrder = tabPanel._tabs.map(t => t.id);
                log(`Initial order: ${initialOrder.join(', ')}`, 'info');
                
                // Note: Full drag simulation requires more complex event handling
                // For now, test the reorder functionality directly
                const tabs = Array.from(tabPanel.shadowRoot.querySelectorAll('.tab'));
                const tabsList = tabPanel.shadowRoot.querySelector('.tabs-list');
                
                // Simulate moving first tab to end
                if (tabs.length >= 3) {
                    tabsList.appendChild(tabs[0]);
                    tabPanel._updateTabOrder();
                    
                    const newOrder = tabPanel._tabs.map(t => t.id);
                    log(`New order: ${newOrder.join(', ')}`, 'info');
                    
                    assert(newOrder[0] !== initialOrder[0], 'Tab order not updated');
                    assert(newOrder[newOrder.length - 1] === initialOrder[0], 'Tab not moved to end');
                }
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(6, 'pass');
                passedTests++;
                log('Test 6: Passed - Drag and drop functionality verified', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(6, 'fail');
                failedTests++;
                log(`Test 6: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 7: Themes
        window.runTest7 = async function() {
            totalTests++;
            setTestStatus(7, 'running');
            const resultEl = document.getElementById('result7');
            
            try {
                log('Test 7: Theme System - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                tabPanel.addTab({ id: 'theme1', label: 'Theme Test', content: 'Content' });
                
                const themes = ['brutal', 'minimal', 'neon', 'glassmorphic'];
                
                for (const theme of themes) {
                    tabPanel.setConfig({ theme });
                    await new Promise(r => setTimeout(r, 100));
                    
                    const container = tabPanel.shadowRoot.querySelector('.tabpanel-container');
                    assert(container.classList.contains(theme), `Theme class ${theme} not applied`);
                    
                    log(`Theme ${theme} applied`, 'info');
                }
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(7, 'pass');
                passedTests++;
                log('Test 7: Passed - All themes working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(7, 'fail');
                failedTests++;
                log(`Test 7: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 8: Animations
        window.runTest8 = async function() {
            totalTests++;
            setTestStatus(8, 'running');
            const resultEl = document.getElementById('result8');
            
            try {
                log('Test 8: Animation Types - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                tabPanel.addTab({ id: 'anim1', label: 'Anim 1', content: 'Content 1' });
                tabPanel.addTab({ id: 'anim2', label: 'Anim 2', content: 'Content 2' });
                
                const animations = ['slide', 'fade', 'flip', 'morph'];
                
                for (const animation of animations) {
                    tabPanel.setConfig({ animation });
                    await new Promise(r => setTimeout(r, 100));
                    
                    // Trigger animation
                    tabPanel.activateTab('anim2');
                    await new Promise(r => setTimeout(r, 100));
                    
                    tabPanel.activateTab('anim1');
                    await new Promise(r => setTimeout(r, 100));
                    
                    log(`Animation ${animation} tested`, 'info');
                }
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(8, 'pass');
                passedTests++;
                log('Test 8: Passed - All animations working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(8, 'fail');
                failedTests++;
                log(`Test 8: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 9: Overflow Handling
        window.runTest9 = async function() {
            totalTests++;
            setTestStatus(9, 'running');
            const resultEl = document.getElementById('result9');
            
            try {
                log('Test 9: Overflow Handling - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                tabPanel.setConfig({ overflow: 'scroll' });
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Add many tabs
                for (let i = 1; i <= 20; i++) {
                    tabPanel.addTab({ 
                        id: `overflow${i}`, 
                        label: `Overflow Tab ${i}`, 
                        content: `Content ${i}` 
                    });
                }
                
                await new Promise(r => setTimeout(r, 200));
                
                // Check scroll buttons
                const scrollLeft = tabPanel.shadowRoot.querySelector('.scroll-left');
                const scrollRight = tabPanel.shadowRoot.querySelector('.scroll-right');
                
                assert(scrollLeft, 'Scroll left button not rendered');
                assert(scrollRight, 'Scroll right button not rendered');
                
                // Test dropdown mode
                tabPanel.setConfig({ overflow: 'dropdown' });
                await new Promise(r => setTimeout(r, 100));
                
                const overflowBtn = tabPanel.shadowRoot.querySelector('.overflow-button');
                assert(overflowBtn, 'Overflow button not rendered');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(9, 'pass');
                passedTests++;
                log('Test 9: Passed - Overflow handling working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(9, 'fail');
                failedTests++;
                log(`Test 9: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 10: Events
        window.runTest10 = async function() {
            totalTests++;
            setTestStatus(10, 'running');
            const resultEl = document.getElementById('result10');
            
            try {
                log('Test 10: Event System - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                let tabChangeFired = false;
                let tabAddFired = false;
                let tabRemoveFired = false;
                let tabUpdateFired = false;
                
                // Add event listeners
                tabPanel.addEventListener('tabchange', (e) => {
                    tabChangeFired = true;
                    assert(e.detail.newTab, 'Tab change event missing newTab');
                });
                
                tabPanel.addEventListener('tabadd', (e) => {
                    tabAddFired = true;
                    assert(e.detail.tab, 'Tab add event missing tab');
                });
                
                tabPanel.addEventListener('tabremove', (e) => {
                    tabRemoveFired = true;
                    assert(e.detail.tab, 'Tab remove event missing tab');
                });
                
                tabPanel.addEventListener('tabupdate', (e) => {
                    tabUpdateFired = true;
                    assert(e.detail.tab, 'Tab update event missing tab');
                });
                
                // Test events
                tabPanel.addTab({ id: 'event1', label: 'Event 1', content: 'Content 1' });
                await new Promise(r => setTimeout(r, 100));
                assert(tabAddFired, 'Tab add event not fired');
                
                tabPanel.addTab({ id: 'event2', label: 'Event 2', content: 'Content 2' });
                tabPanel.activateTab('event2');
                await new Promise(r => setTimeout(r, 100));
                assert(tabChangeFired, 'Tab change event not fired');
                
                tabPanel.updateTab('event2', { label: 'Updated' });
                await new Promise(r => setTimeout(r, 100));
                assert(tabUpdateFired, 'Tab update event not fired');
                
                tabPanel.removeTab('event1');
                await new Promise(r => setTimeout(r, 100));
                assert(tabRemoveFired, 'Tab remove event not fired');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(10, 'pass');
                passedTests++;
                log('Test 10: Passed - All events working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(10, 'fail');
                failedTests++;
                log(`Test 10: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 11: Performance
        window.runTest11 = async function() {
            totalTests++;
            setTestStatus(11, 'running');
            const resultEl = document.getElementById('result11');
            
            try {
                log('Test 11: Performance - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Add many tabs
                const startTime = performance.now();
                
                for (let i = 1; i <= 50; i++) {
                    tabPanel.addTab({
                        id: `perf${i}`,
                        label: `Performance ${i}`,
                        content: `<div>Content for tab ${i}</div>`
                    });
                }
                
                const addTime = performance.now() - startTime;
                log(`Added 50 tabs in ${addTime.toFixed(2)}ms`, 'info');
                assert(addTime < 1000, 'Adding tabs too slow');
                
                // Test rapid activation
                const activateStart = performance.now();
                
                for (let i = 1; i <= 10; i++) {
                    tabPanel.activateTab(`perf${i}`);
                }
                
                const activateTime = performance.now() - activateStart;
                log(`Activated 10 tabs in ${activateTime.toFixed(2)}ms`, 'info');
                assert(activateTime < 500, 'Activation too slow');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(11, 'pass');
                passedTests++;
                log('Test 11: Passed - Performance acceptable', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(11, 'fail');
                failedTests++;
                log(`Test 11: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 12: Edge Cases
        window.runTest12 = async function() {
            totalTests++;
            setTestStatus(12, 'running');
            const resultEl = document.getElementById('result12');
            
            try {
                log('Test 12: Edge Cases - Starting', 'info');
                
                const tabPanel = document.createElement('brutal-tabpanel');
                document.getElementById('testArea').appendChild(tabPanel);
                
                // Test empty state
                tabPanel.activateTab('nonexistent');
                assert(!tabPanel._activeTab, 'Non-existent tab activated');
                
                // Test disabled tab
                tabPanel.addTab({ 
                    id: 'disabled', 
                    label: 'Disabled', 
                    content: 'Content',
                    disabled: true 
                });
                
                tabPanel.activateTab('disabled');
                assert(tabPanel._activeTab !== 'disabled', 'Disabled tab activated');
                
                // Test duplicate ID
                tabPanel.addTab({ id: 'dup', label: 'Original', content: 'Original' });
                tabPanel.addTab({ id: 'dup', label: 'Duplicate', content: 'Duplicate' });
                
                // Should handle gracefully
                const dupTabs = tabPanel._tabs.filter(t => t.id === 'dup');
                assert(dupTabs.length === 2, 'Duplicate handling failed');
                
                // Test XSS prevention
                tabPanel.addTab({
                    id: 'xss',
                    label: '<script>alert("xss")</script>',
                    content: '<img src=x onerror="alert(\'xss\')">'
                });
                
                await new Promise(r => setTimeout(r, 100));
                
                const xssTab = tabPanel.shadowRoot.querySelector('[data-tab-id="xss"] .tab-label');
                assert(!xssTab.innerHTML.includes('<script>'), 'XSS not prevented in label');
                
                // Cleanup
                tabPanel.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(12, 'pass');
                passedTests++;
                log('Test 12: Passed - Edge cases handled correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(12, 'fail');
                failedTests++;
                log(`Test 12: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Run all tests
        window.runAllTests = async function() {
            log('Running all tests...', 'warning');
            clearResults();
            
            const tests = [
                runTest1, runTest2, runTest3, runTest4,
                runTest5, runTest6, runTest7, runTest8,
                runTest9, runTest10, runTest11, runTest12
            ];
            
            for (const test of tests) {
                await test();
                await new Promise(r => setTimeout(r, 100));
            }
            
            log(`All tests completed: ${passedTests}/${totalTests} passed`, 
                failedTests === 0 ? 'success' : 'error');
        };
        
        // Clear results
        window.clearResults = function() {
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            
            document.getElementById('testOutput').innerHTML = '';
            document.getElementById('testArea').innerHTML = '';
            
            for (let i = 1; i <= 12; i++) {
                document.getElementById(`status${i}`).className = 'status-indicator';
                document.getElementById(`result${i}`).textContent = '';
            }
            
            updateSummary();
            log('Results cleared', 'info');
        };
        
        // Initial setup
        log('BRUTAL TabPanel Test Suite Ready', 'success');
        log('Click "Run All Tests" to start comprehensive testing', 'info');
    </script>
</body>
</html>