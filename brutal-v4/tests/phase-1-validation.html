<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL V4 - Phase 1 Foundation Validation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #555;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .component-demo {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 BRUTAL V4 - Phase 1 Foundation Validation</h1>
        
        <div class="test-section">
            <h2>Browser Support Validation</h2>
            <div id="browser-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Core Module Loading</h2>
            <div id="module-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Component Foundation</h2>
            <div id="component-tests"></div>
            <div id="test-component" class="component-demo"></div>
        </div>
        
        <div class="test-section">
            <h2>State Management</h2>
            <div id="state-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Template System</h2>
            <div id="template-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Event System</h2>
            <div id="event-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Registry System</h2>
            <div id="registry-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Routing System</h2>
            <div id="routing-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Accessibility System</h2>
            <div id="accessibility-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Form System</h2>
            <div id="form-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Design System</h2>
            <div id="design-tests"></div>
        </div>
        
        <div class="test-section">
            <h2>Performance Metrics</h2>
            <div class="metrics" id="metrics"></div>
        </div>
        
        <div class="test-section">
            <h2>Integration Test</h2>
            <button onclick="runIntegrationTest()">Run Full Integration Test</button>
            <div id="integration-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Test Log</h2>
            <div id="test-log" class="log"></div>
        </div>
    </div>

    <script type="module">
        // Import BRUTAL V4 core
        import {
            BrutalComponent,
            BrutalState,
            html,
            css,
            BrutalEvents,
            BrutalRegistry,
            BrutalRouter,
            BrutalA11y,
            BrutalForms,
            BrutalDesign,
            initBrutal,
            getBrutalStatus,
            BRUTAL_INFO
        } from './core/index.js';

        // Test utilities
        const log = (message, type = 'info') => {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[BRUTAL Test] ${message}`);
        };

        const addResult = (containerId, message, passed) => {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.innerHTML = `${passed ? '✅' : '❌'} ${message}`;
            container.appendChild(resultDiv);
            
            log(`${message}: ${passed ? 'PASS' : 'FAIL'}`, passed ? 'pass' : 'fail');
        };

        const addInfo = (containerId, message) => {
            const container = document.getElementById(containerId);
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result test-info';
            infoDiv.innerHTML = `ℹ️ ${message}`;
            container.appendChild(infoDiv);
        };

        // Test 1: Browser Support
        function testBrowserSupport() {
            log('Testing browser support...');
            
            const tests = [
                ['Custom Elements', 'customElements' in window],
                ['Shadow DOM', 'attachShadow' in Element.prototype],
                ['Template Elements', 'content' in document.createElement('template')],
                ['ES Modules', typeof Symbol !== 'undefined'],
                ['Proxy Support', typeof Proxy !== 'undefined'],
                ['EventTarget', typeof EventTarget !== 'undefined']
            ];
            
            tests.forEach(([name, supported]) => {
                addResult('browser-tests', `${name} support`, supported);
            });
        }

        // Test 2: Module Loading
        function testModuleLoading() {
            log('Testing module loading...');
            
            const tests = [
                ['BrutalComponent class', typeof BrutalComponent === 'function'],
                ['BrutalState class', typeof BrutalState === 'function'],
                ['html function', typeof html === 'function'],
                ['css function', typeof css === 'function'],
                ['BrutalEvents class', typeof BrutalEvents === 'function'],
                ['BrutalRegistry class', typeof BrutalRegistry === 'function'],
                ['BrutalRouter class', typeof BrutalRouter === 'function'],
                ['BrutalA11y class', typeof BrutalA11y === 'function'],
                ['BrutalForms class', typeof BrutalForms === 'function'],
                ['BrutalDesign class', typeof BrutalDesign === 'function'],
                ['initBrutal function', typeof initBrutal === 'function'],
                ['BRUTAL_INFO object', typeof BRUTAL_INFO === 'object']
            ];
            
            tests.forEach(([name, loaded]) => {
                addResult('module-tests', `${name} loaded`, loaded);
            });
        }

        // Test 3: Component Foundation
        function testComponentFoundation() {
            log('Testing component foundation...');
            
            try {
                // Create test component class
                class TestComponent extends BrutalComponent {
                    constructor() {
                        super();
                        this.testProp = 'test-value';
                    }
                    
                    createTemplate() {
                        this._template = html`
                            <style>
                                :host {
                                    display: block;
                                    padding: 20px;
                                    background: #e7f3ff;
                                    border: 2px solid #007bff;
                                    border-radius: 8px;
                                }
                            </style>
                            <div>
                                <h3>Test Component</h3>
                                <p>Component is working correctly!</p>
                                <p>Test Property: ${this.testProp}</p>
                            </div>
                        `;
                    }
                }
                
                // Register component
                BrutalRegistry.define('test-component', TestComponent);
                addResult('component-tests', 'Component class creation', true);
                addResult('component-tests', 'Component registration', true);
                
                // Create and test instance
                const testElement = document.createElement('test-component');
                document.getElementById('test-component').appendChild(testElement);
                
                // Wait for connection
                setTimeout(() => {
                    const hasContent = testElement.shadowRoot && testElement.shadowRoot.children.length > 0;
                    addResult('component-tests', 'Component rendering', hasContent);
                    addResult('component-tests', 'Shadow DOM creation', !!testElement.shadowRoot);
                }, 100);
                
            } catch (error) {
                addResult('component-tests', `Component creation: ${error.message}`, false);
            }
        }

        // Test 4: State Management
        function testStateManagement() {
            log('Testing state management...');
            
            try {
                const state = new BrutalState({ count: 0, name: 'test' });
                
                addResult('state-tests', 'State creation', true);
                
                // Test getter
                const count = state.get('count');
                addResult('state-tests', 'State getter', count === 0);
                
                // Test setter
                state.set({ count: 1 });
                const newCount = state.get('count');
                addResult('state-tests', 'State setter', newCount === 1);
                
                // Test subscription
                let eventFired = false;
                const unsubscribe = state.subscribe(() => {
                    eventFired = true;
                });
                
                state.set({ count: 2 });
                setTimeout(() => {
                    addResult('state-tests', 'State subscription', eventFired);
                    unsubscribe();
                }, 50);
                
                // Test update function
                state.update(s => s.count = 3);
                const updatedCount = state.get('count');
                addResult('state-tests', 'State update function', updatedCount === 3);
                
            } catch (error) {
                addResult('state-tests', `State management: ${error.message}`, false);
            }
        }

        // Test 5: Template System
        function testTemplateSystem() {
            log('Testing template system...');
            
            try {
                // Test HTML template
                const template = html`<div>Hello World</div>`;
                addResult('template-tests', 'HTML template creation', template instanceof HTMLTemplateElement);
                
                // Test CSS template
                const styles = css`color: red; font-size: 16px;`;
                addResult('template-tests', 'CSS template creation', typeof styles === 'string');
                
                // Test interpolation
                const name = 'BRUTAL';
                const interpolated = html`<div>Hello ${name}</div>`;
                const hasInterpolation = interpolated.innerHTML.includes('BRUTAL');
                addResult('template-tests', 'Template interpolation', hasInterpolation);
                
                // Test template caching (second call should be faster)
                const start = performance.now();
                html`<div>Cached template</div>`;
                const firstTime = performance.now() - start;
                
                const start2 = performance.now();
                html`<div>Cached template</div>`;
                const secondTime = performance.now() - start2;
                
                addResult('template-tests', 'Template caching', secondTime <= firstTime);
                
            } catch (error) {
                addResult('template-tests', `Template system: ${error.message}`, false);
            }
        }

        // Test 6: Event System
        function testEventSystem() {
            log('Testing event system...');
            
            try {
                const div = document.createElement('div');
                const events = new BrutalEvents(div);
                
                addResult('event-tests', 'Event manager creation', true);
                
                // Test event listener
                let eventFired = false;
                events.on('test-event', () => {
                    eventFired = true;
                });
                
                events.emit('test-event');
                setTimeout(() => {
                    addResult('event-tests', 'Event emission and handling', eventFired);
                }, 50);
                
                // Test event removal
                const handler = () => {};
                events.on('remove-test', handler);
                const removed = events.off('remove-test', handler);
                addResult('event-tests', 'Event listener removal', removed);
                
                // Test once event
                let onceCount = 0;
                events.once('once-test', () => {
                    onceCount++;
                });
                
                events.emit('once-test');
                events.emit('once-test');
                
                setTimeout(() => {
                    addResult('event-tests', 'Once event handler', onceCount === 1);
                }, 50);
                
            } catch (error) {
                addResult('event-tests', `Event system: ${error.message}`, false);
            }
        }

        // Test 7: Registry System
        function testRegistrySystem() {
            log('Testing registry system...');
            
            try {
                // Test component listing
                const components = BrutalRegistry.list();
                addResult('registry-tests', 'Component listing', Array.isArray(components));
                
                // Test component metadata
                const metadata = BrutalRegistry.get('test-component');
                addResult('registry-tests', 'Component metadata retrieval', !!metadata);
                
                // Test component existence check
                const exists = BrutalRegistry.has('test-component');
                addResult('registry-tests', 'Component existence check', exists);
                
                // Test registry stats
                const stats = BrutalRegistry.getStats();
                addResult('registry-tests', 'Registry statistics', typeof stats === 'object');
                
                addInfo('registry-tests', `Registered components: ${components.length}`);
                addInfo('registry-tests', `Registry stats: ${JSON.stringify(stats)}`);
                
            } catch (error) {
                addResult('registry-tests', `Registry system: ${error.message}`, false);
            }
        }

        // Test 8: Routing System
        function testRoutingSystem() {
            log('Testing routing system...');
            
            try {
                // Test route definition
                BrutalRouter.define('/test', () => {
                    return document.createElement('div');
                });
                addResult('routing-tests', 'Route definition', true);
                
                // Test route finding
                const route = BrutalRouter.findRoute('/test');
                addResult('routing-tests', 'Route finding', !!route);
                
                // Test path normalization
                const normalized = BrutalRouter.normalizePath('/test/');
                addResult('routing-tests', 'Path normalization', normalized === '/test');
                
                // Test query parsing
                const query = BrutalRouter.parseQuery('?foo=bar&baz=qux');
                addResult('routing-tests', 'Query parsing', query.foo === 'bar' && query.baz === 'qux');
                
            } catch (error) {
                addResult('routing-tests', `Routing system: ${error.message}`, false);
            }
        }

        // Test 9: Accessibility System
        function testAccessibilitySystem() {
            log('Testing accessibility system...');
            
            try {
                // Test ARIA role setting
                const testDiv = document.createElement('div');
                const roleSet = BrutalA11y.setRole(testDiv, 'button');
                addResult('accessibility-tests', 'ARIA role setting', roleSet && testDiv.getAttribute('role') === 'button');
                
                // Test label setting
                const labelSet = BrutalA11y.setLabel(testDiv, 'Test button');
                addResult('accessibility-tests', 'ARIA label setting', labelSet && testDiv.getAttribute('aria-label') === 'Test button');
                
                // Test announcement (visual check)
                BrutalA11y.announce('Test announcement');
                addResult('accessibility-tests', 'Screen reader announcement', true);
                
                // Test focusable elements detection
                const focusable = BrutalA11y.getFocusableElements();
                addResult('accessibility-tests', 'Focusable elements detection', Array.isArray(focusable));
                
            } catch (error) {
                addResult('accessibility-tests', `Accessibility system: ${error.message}`, false);
            }
        }

        // Test 10: Form System
        function testFormSystem() {
            log('Testing form system...');
            
            try {
                // Create test form
                const form = document.createElement('form');
                const input = document.createElement('input');
                input.type = 'email';
                input.name = 'email';
                input.required = true;
                form.appendChild(input);
                
                // Test form enhancement
                const instance = BrutalForms.enhance(form);
                addResult('form-tests', 'Form enhancement', !!instance);
                
                // Test validation
                input.value = 'invalid-email';
                const isValid = BrutalForms.validate(form, false);
                addResult('form-tests', 'Form validation', !isValid);
                
                // Test serialization
                input.value = 'test@example.com';
                const data = BrutalForms.serialize(form);
                addResult('form-tests', 'Form serialization', data.email === 'test@example.com');
                
                // Test validator registration
                BrutalForms.addValidator('custom-test', (value) => value === 'test');
                const hasValidator = BrutalForms.validators.has('custom-test');
                addResult('form-tests', 'Custom validator registration', hasValidator);
                
            } catch (error) {
                addResult('form-tests', `Form system: ${error.message}`, false);
            }
        }

        // Test 11: Design System
        function testDesignSystem() {
            log('Testing design system...');
            
            try {
                // Test token retrieval
                const primaryColor = BrutalDesign.getToken('colors', 'primary-500');
                addResult('design-tests', 'Design token retrieval', !!primaryColor);
                
                // Test theme application
                const themeApplied = BrutalDesign.applyTheme('dark');
                addResult('design-tests', 'Theme application', themeApplied);
                
                // Test breakpoint detection
                const currentBreakpoint = BrutalDesign.getCurrentBreakpoint();
                addResult('design-tests', 'Breakpoint detection', typeof currentBreakpoint === 'string');
                
                // Test available themes
                const themes = BrutalDesign.getAvailableThemes();
                addResult('design-tests', 'Available themes retrieval', Array.isArray(themes) && themes.length > 0);
                
                // Switch back to light theme
                BrutalDesign.applyTheme('light');
                
            } catch (error) {
                addResult('design-tests', `Design system: ${error.message}`, false);
            }
        }

        // Test 8: Performance Metrics
        function updateMetrics() {
            const status = getBrutalStatus();
            const metricsContainer = document.getElementById('metrics');
            
            const metrics = [
                { label: 'Init Time', value: `${status.initTime?.toFixed(2) || 0}ms` },
                { label: 'Components', value: status.registry?.totalComponents || 0 },
                { label: 'Success Rate', value: status.registry?.successRate || '0%' },
                { label: 'Memory Used', value: status.memory ? `${(status.memory.used / 1024 / 1024).toFixed(2)}MB` : 'N/A' }
            ];
            
            metricsContainer.innerHTML = metrics.map(metric => `
                <div class="metric">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        // Integration Test
        window.runIntegrationTest = function() {
            log('Running full integration test...');
            
            const resultContainer = document.getElementById('integration-result');
            resultContainer.innerHTML = '<div class="test-result test-info">Running integration test...</div>';
            
            try {
                // Create a complex component that uses all systems
                class IntegrationTestComponent extends BrutalComponent {
                    constructor() {
                        super();
                        this.initializeState();
                        this.createTemplate();
                    }
                    
                    initializeState() {
                        this._state = new BrutalState({
                            counter: 0,
                            message: 'Integration test running...'
                        });
                        
                        this._state.subscribe(() => {
                            this.render();
                        });
                    }
                    
                    createTemplate() {
                        this._template = html`
                            <style>
                                ${css`
                                    :host {
                                        display: block;
                                        padding: 20px;
                                        background: #f0f8ff;
                                        border: 2px solid #4CAF50;
                                        border-radius: 8px;
                                        margin: 10px 0;
                                    }
                                    
                                    button {
                                        padding: 10px 20px;
                                        margin: 5px;
                                        border: none;
                                        border-radius: 4px;
                                        background: #4CAF50;
                                        color: white;
                                        cursor: pointer;
                                    }
                                    
                                    button:hover {
                                        background: #45a049;
                                    }
                                `}
                            </style>
                            <div>
                                <h4>Integration Test Component</h4>
                                <p>Counter: ${this._state.get('counter')}</p>
                                <p>Message: ${this._state.get('message')}</p>
                                <button id="increment">Increment</button>
                                <button id="reset">Reset</button>
                            </div>
                        `;
                    }
                    
                    setupEventListeners() {
                        this.on('click', (event) => {
                            if (event.target.id === 'increment') {
                                this._state.update(state => state.counter++);
                            } else if (event.target.id === 'reset') {
                                this._state.set({ counter: 0, message: 'Reset!' });
                            }
                        });
                    }
                }
                
                // Register and create component
                BrutalRegistry.define('integration-test-component', IntegrationTestComponent);
                
                const testElement = document.createElement('integration-test-component');
                resultContainer.innerHTML = '';
                resultContainer.appendChild(testElement);
                
                setTimeout(() => {
                    const success = testElement.shadowRoot && 
                                  testElement.shadowRoot.children.length > 0 &&
                                  testElement._state &&
                                  testElement._state.get('counter') === 0;
                    
                    if (success) {
                        resultContainer.insertAdjacentHTML('afterbegin', 
                            '<div class="test-result test-pass">✅ Integration test passed! All systems working together.</div>'
                        );
                    } else {
                        resultContainer.insertAdjacentHTML('afterbegin', 
                            '<div class="test-result test-fail">❌ Integration test failed.</div>'
                        );
                    }
                }, 200);
                
            } catch (error) {
                resultContainer.innerHTML = `<div class="test-result test-fail">❌ Integration test failed: ${error.message}</div>`;
            }
        };

        // Run all tests
        function runAllTests() {
            log('Starting BRUTAL V4 Phase 1 validation tests...');
            
            testBrowserSupport();
            testModuleLoading();
            
            setTimeout(() => {
                testComponentFoundation();
                testStateManagement();
                testTemplateSystem();
                testEventSystem();
                testRegistrySystem();
                testRoutingSystem();
                testAccessibilitySystem();
                testFormSystem();
                testDesignSystem();
                updateMetrics();
                
                log('All Phase 1 validation tests completed');
            }, 100);
        }

        // Start tests when page loads
        document.addEventListener('DOMContentLoaded', runAllTests);
        
        // Update metrics every 5 seconds
        setInterval(updateMetrics, 5000);
    </script>
</body>
</html>