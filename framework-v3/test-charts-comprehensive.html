<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL V3 - Charts Comprehensive Test Suite</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui;
            background: #000;
            color: #0f0;
        }
        
        .test-container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #0f0, #0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-shadow: 0 0 30px #0f0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #0f0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .test-card:hover {
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }
        
        button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0;
        }
        
        button:disabled {
            background: #333;
            border-color: #666;
            color: #666;
            cursor: not-allowed;
        }
        
        .test-output {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .log-success { background: rgba(0, 255, 0, 0.1); color: #0f0; }
        .log-error { background: rgba(255, 0, 0, 0.1); color: #f00; }
        .log-warning { background: rgba(255, 255, 0, 0.1); color: #ff0; }
        .log-info { background: rgba(0, 255, 255, 0.1); color: #0ff; }
        
        .chart-test {
            height: 300px;
            border: 1px solid #0f0;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background: #666;
        }
        
        .status-indicator.pass { background: #0f0; box-shadow: 0 0 10px #0f0; }
        .status-indicator.fail { background: #f00; box-shadow: 0 0 10px #f00; }
        .status-indicator.running { 
            background: #ff0; 
            box-shadow: 0 0 10px #ff0;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .test-summary {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        
        .test-summary.fail {
            background: rgba(255, 0, 0, 0.1);
            border-color: #f00;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>BRUTAL V3 - Charts Component Test Suite</h1>
        <p>Comprehensive testing for GPU-accelerated charting capabilities</p>
        
        <div class="test-summary" id="testSummary">
            <h2>Test Summary</h2>
            <div>Total Tests: <span id="totalTests">0</span></div>
            <div>Passed: <span id="passedTests" style="color: #0f0;">0</span></div>
            <div>Failed: <span id="failedTests" style="color: #f00;">0</span></div>
            <div>Status: <span id="testStatus">Not Started</span></div>
        </div>
        
        <div class="test-grid">
            <!-- Test 1: Basic Initialization -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status1"></span>Basic Initialization</h3>
                <p>Tests chart creation and shadow DOM setup</p>
                <button onclick="runTest1()">Run Test</button>
                <div id="result1"></div>
            </div>
            
            <!-- Test 2: Data Rendering -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status2"></span>Data Rendering</h3>
                <p>Tests different chart types with data</p>
                <button onclick="runTest2()">Run Test</button>
                <div id="result2"></div>
            </div>
            
            <!-- Test 3: WebGL Support -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status3"></span>WebGL Support</h3>
                <p>Tests GPU acceleration and shaders</p>
                <button onclick="runTest3()">Run Test</button>
                <div id="result3"></div>
            </div>
            
            <!-- Test 4: Real-time Updates -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status4"></span>Real-time Updates</h3>
                <p>Tests real-time data streaming</p>
                <button onclick="runTest4()">Run Test</button>
                <div id="result4"></div>
            </div>
            
            <!-- Test 5: Interactions -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status5"></span>Interactions</h3>
                <p>Tests zoom, pan, and hover effects</p>
                <button onclick="runTest5()">Run Test</button>
                <div id="result5"></div>
            </div>
            
            <!-- Test 6: Chart Transitions -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status6"></span>Chart Transitions</h3>
                <p>Tests smooth transitions between types</p>
                <button onclick="runTest6()">Run Test</button>
                <div id="result6"></div>
            </div>
            
            <!-- Test 7: Performance -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status7"></span>Performance</h3>
                <p>Tests with large datasets</p>
                <button onclick="runTest7()">Run Test</button>
                <div id="result7"></div>
            </div>
            
            <!-- Test 8: Themes -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status8"></span>Themes</h3>
                <p>Tests all theme variations</p>
                <button onclick="runTest8()">Run Test</button>
                <div id="result8"></div>
            </div>
            
            <!-- Test 9: API Methods -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status9"></span>API Methods</h3>
                <p>Tests public API functionality</p>
                <button onclick="runTest9()">Run Test</button>
                <div id="result9"></div>
            </div>
            
            <!-- Test 10: Events -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status10"></span>Events</h3>
                <p>Tests custom event dispatching</p>
                <button onclick="runTest10()">Run Test</button>
                <div id="result10"></div>
            </div>
            
            <!-- Test 11: Memory Leaks -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status11"></span>Memory Management</h3>
                <p>Tests cleanup and memory leaks</p>
                <button onclick="runTest11()">Run Test</button>
                <div id="result11"></div>
            </div>
            
            <!-- Test 12: Edge Cases -->
            <div class="test-card">
                <h3><span class="status-indicator" id="status12"></span>Edge Cases</h3>
                <p>Tests error handling and edge cases</p>
                <button onclick="runTest12()">Run Test</button>
                <div id="result12"></div>
            </div>
        </div>
        
        <div style="margin: 40px 0;">
            <button onclick="runAllTests()" style="font-size: 1.2rem; padding: 15px 30px;">
                Run All Tests
            </button>
            <button onclick="clearResults()" style="font-size: 1.2rem; padding: 15px 30px;">
                Clear Results
            </button>
        </div>
        
        <h2>Test Output</h2>
        <div class="test-output" id="testOutput"></div>
        
        <!-- Hidden test area -->
        <div id="testArea" style="display: none;"></div>
    </div>

    <script type="module">
        import { Charts } from './04-components/ui/Charts.js';
        
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        
        function log(message, type = 'info') {
            const output = document.getElementById('testOutput');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
        }
        
        function updateSummary() {
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('passedTests').textContent = passedTests;
            document.getElementById('failedTests').textContent = failedTests;
            
            const status = totalTests === 0 ? 'Not Started' :
                          failedTests === 0 ? 'All Passed ✓' :
                          'Some Failed ✗';
            document.getElementById('testStatus').textContent = status;
            
            const summary = document.getElementById('testSummary');
            summary.className = failedTests > 0 ? 'test-summary fail' : 'test-summary';
        }
        
        function setTestStatus(testId, status) {
            const indicator = document.getElementById(`status${testId}`);
            indicator.className = `status-indicator ${status}`;
        }
        
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message);
            }
        }
        
        // Test 1: Basic Initialization
        window.runTest1 = async function() {
            totalTests++;
            setTestStatus(1, 'running');
            const resultEl = document.getElementById('result1');
            
            try {
                log('Test 1: Basic Initialization - Starting', 'info');
                
                // Create chart element
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                // Wait for initialization
                await new Promise(r => setTimeout(r, 100));
                
                // Verify shadow DOM
                assert(chart.shadowRoot, 'Shadow DOM not created');
                assert(chart instanceof Charts, 'Not a Charts instance');
                
                // Check template rendering
                const container = chart.shadowRoot.querySelector('.charts-container');
                assert(container, 'Container not found');
                
                // Check canvases
                const canvas = chart.shadowRoot.querySelector('.charts-canvas');
                assert(canvas, 'Canvas not found');
                
                // Check initial state
                assert(Array.isArray(chart._datasets), 'Datasets not initialized');
                assert(chart._config.type === 'line', 'Default type not set');
                
                // Cleanup
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(1, 'pass');
                passedTests++;
                log('Test 1: Passed - Chart initializes correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(1, 'fail');
                failedTests++;
                log(`Test 1: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 2: Data Rendering
        window.runTest2 = async function() {
            totalTests++;
            setTestStatus(2, 'running');
            const resultEl = document.getElementById('result2');
            
            try {
                log('Test 2: Data Rendering - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Test line chart data
                const lineData = [{
                    label: 'Test Data',
                    data: [
                        { x: 0, y: 10 },
                        { x: 1, y: 20 },
                        { x: 2, y: 15 },
                        { x: 3, y: 25 }
                    ]
                }];
                
                chart.setData(lineData);
                await new Promise(r => setTimeout(r, 300));
                
                assert(chart._datasets.length === 1, 'Dataset not set');
                assert(chart._datasets[0].data.length === 4, 'Data points not set');
                assert(chart._needsRedraw === false, 'Chart not rendered');
                
                // Test different chart types
                const types = ['bar', 'area', 'scatter', 'pie'];
                for (const type of types) {
                    chart.setType(type);
                    await new Promise(r => setTimeout(r, 200));
                    assert(chart._config.type === type, `Type not changed to ${type}`);
                }
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(2, 'pass');
                passedTests++;
                log('Test 2: Passed - Data renders correctly', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(2, 'fail');
                failedTests++;
                log(`Test 2: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 3: WebGL Support
        window.runTest3 = async function() {
            totalTests++;
            setTestStatus(3, 'running');
            const resultEl = document.getElementById('result3');
            
            try {
                log('Test 3: WebGL Support - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.setAttribute('webgl-enabled', 'true');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Check WebGL initialization
                if (chart._config.webglEnabled) {
                    const webglCanvas = chart.shadowRoot.querySelector('.charts-webgl-canvas');
                    assert(webglCanvas, 'WebGL canvas not found');
                    
                    if (chart._gl) {
                        assert(chart._gl instanceof WebGLRenderingContext || 
                               chart._gl instanceof WebGL2RenderingContext, 
                               'Invalid WebGL context');
                        
                        // Check shaders
                        assert(Object.keys(chart._programs).length > 0, 'No shaders loaded');
                        log('WebGL enabled with shaders', 'info');
                    } else {
                        log('WebGL not supported in test environment', 'warning');
                    }
                } else {
                    log('WebGL disabled', 'warning');
                }
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(3, 'pass');
                passedTests++;
                log('Test 3: Passed - WebGL support verified', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(3, 'fail');
                failedTests++;
                log(`Test 3: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 4: Real-time Updates
        window.runTest4 = async function() {
            totalTests++;
            setTestStatus(4, 'running');
            const resultEl = document.getElementById('result4');
            
            try {
                log('Test 4: Real-time Updates - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.setAttribute('realtime', 'true');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Set initial data
                chart.setData([{
                    label: 'Realtime',
                    data: [{ x: 0, y: 50 }]
                }]);
                
                const initialLength = chart._datasets[0].data.length;
                
                // Wait for realtime updates
                await new Promise(r => setTimeout(r, 500));
                
                const updatedLength = chart._datasets[0].data.length;
                assert(updatedLength > initialLength, 'Realtime data not updating');
                
                // Stop realtime
                chart.setAttribute('realtime', 'false');
                await new Promise(r => setTimeout(r, 200));
                
                const finalLength = chart._datasets[0].data.length;
                await new Promise(r => setTimeout(r, 200));
                assert(chart._datasets[0].data.length === finalLength, 'Realtime not stopped');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(4, 'pass');
                passedTests++;
                log('Test 4: Passed - Real-time updates working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(4, 'fail');
                failedTests++;
                log(`Test 4: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 5: Interactions
        window.runTest5 = async function() {
            totalTests++;
            setTestStatus(5, 'running');
            const resultEl = document.getElementById('result5');
            
            try {
                log('Test 5: Interactions - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Set data
                chart.setData([{
                    label: 'Interactive',
                    data: Array(10).fill(0).map((_, i) => ({ x: i, y: Math.random() * 100 }))
                }]);
                
                // Test zoom
                const initialZoom = chart._zoom.x;
                chart.zoom(1.5);
                assert(chart._zoom.x === initialZoom * 1.5, 'Zoom not applied');
                
                // Test reset
                chart.reset();
                assert(chart._zoom.x === 1 && chart._zoom.y === 1, 'Reset failed');
                assert(chart._pan.x === 0 && chart._pan.y === 0, 'Pan not reset');
                
                // Test events
                let zoomEventFired = false;
                chart.addEventListener('zoom', () => { zoomEventFired = true; });
                chart.zoom(2);
                await new Promise(r => setTimeout(r, 50));
                assert(zoomEventFired, 'Zoom event not fired');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(5, 'pass');
                passedTests++;
                log('Test 5: Passed - Interactions working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(5, 'fail');
                failedTests++;
                log(`Test 5: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 6: Chart Transitions
        window.runTest6 = async function() {
            totalTests++;
            setTestStatus(6, 'running');
            const resultEl = document.getElementById('result6');
            
            try {
                log('Test 6: Chart Transitions - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Set initial data
                const data = [{
                    label: 'Transition Test',
                    data: [
                        { x: 0, y: 10 },
                        { x: 1, y: 20 },
                        { x: 2, y: 30 },
                        { x: 3, y: 25 }
                    ]
                }];
                
                chart.setData(data);
                
                // Test transitions
                const types = ['line', 'bar', 'area', 'scatter'];
                for (const type of types) {
                    chart.setType(type);
                    assert(chart._isAnimating === true, `Animation not started for ${type}`);
                    await new Promise(r => setTimeout(r, 300));
                }
                
                // Check particles created during transition
                assert(chart._particles.length > 0 || !chart._config.webglEnabled, 
                       'Transition particles not created');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(6, 'pass');
                passedTests++;
                log('Test 6: Passed - Transitions smooth', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(6, 'fail');
                failedTests++;
                log(`Test 6: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 7: Performance
        window.runTest7 = async function() {
            totalTests++;
            setTestStatus(7, 'running');
            const resultEl = document.getElementById('result7');
            
            try {
                log('Test 7: Performance - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Generate large dataset
                const largeData = [{
                    label: 'Performance Test',
                    data: Array(1000).fill(0).map((_, i) => ({
                        x: i,
                        y: Math.sin(i * 0.1) * 50 + 50
                    }))
                }];
                
                const startTime = performance.now();
                chart.setData(largeData);
                
                // Wait for rendering
                await new Promise(r => setTimeout(r, 500));
                
                const renderTime = performance.now() - startTime;
                log(`Rendered 1000 points in ${renderTime.toFixed(2)}ms`, 'info');
                
                // Check FPS
                const fps = chart._fps;
                assert(fps > 30, `FPS too low: ${fps}`);
                log(`FPS: ${fps.toFixed(1)}`, 'info');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(7, 'pass');
                passedTests++;
                log('Test 7: Passed - Performance acceptable', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(7, 'fail');
                failedTests++;
                log(`Test 7: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 8: Themes
        window.runTest8 = async function() {
            totalTests++;
            setTestStatus(8, 'running');
            const resultEl = document.getElementById('result8');
            
            try {
                log('Test 8: Themes - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                const themes = ['brutal', 'neon', 'minimal', 'holographic'];
                
                for (const theme of themes) {
                    chart.setAttribute('theme', theme);
                    await new Promise(r => setTimeout(r, 200));
                    
                    assert(chart._config.theme === theme, `Theme not set to ${theme}`);
                    
                    const container = chart.shadowRoot.querySelector('.charts-container');
                    assert(container.classList.contains(theme), `Theme class not applied: ${theme}`);
                    
                    log(`Theme ${theme} applied`, 'info');
                }
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(8, 'pass');
                passedTests++;
                log('Test 8: Passed - All themes working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(8, 'fail');
                failedTests++;
                log(`Test 8: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 9: API Methods
        window.runTest9 = async function() {
            totalTests++;
            setTestStatus(9, 'running');
            const resultEl = document.getElementById('result9');
            
            try {
                log('Test 9: API Methods - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Test setData
                const data1 = [{ label: 'Test 1', data: [{ x: 0, y: 10 }] }];
                chart.setData(data1);
                assert(chart._datasets.length === 1, 'setData failed');
                
                // Test addDataset
                const dataset2 = { label: 'Test 2', data: [{ x: 0, y: 20 }] };
                chart.addDataset(dataset2);
                assert(chart._datasets.length === 2, 'addDataset failed');
                
                // Test updateDataset
                const newData = [{ x: 0, y: 30 }, { x: 1, y: 40 }];
                chart.updateDataset(0, newData);
                assert(chart._datasets[0].data.length === 2, 'updateDataset failed');
                
                // Test removeDataset
                chart.removeDataset(1);
                assert(chart._datasets.length === 1, 'removeDataset failed');
                
                // Test state getter
                const state = chart.state;
                assert(typeof state === 'object', 'State not returned');
                assert(state.type === chart._config.type, 'State type mismatch');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(9, 'pass');
                passedTests++;
                log('Test 9: Passed - API methods working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(9, 'fail');
                failedTests++;
                log(`Test 9: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 10: Events
        window.runTest10 = async function() {
            totalTests++;
            setTestStatus(10, 'running');
            const resultEl = document.getElementById('result10');
            
            try {
                log('Test 10: Events - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Test zoom event
                let zoomFired = false;
                let zoomDetail = null;
                
                chart.addEventListener('zoom', (e) => {
                    zoomFired = true;
                    zoomDetail = e.detail;
                });
                
                chart.zoom(2);
                await new Promise(r => setTimeout(r, 50));
                
                assert(zoomFired, 'Zoom event not fired');
                assert(zoomDetail && zoomDetail.x === 2, 'Zoom detail incorrect');
                
                // Test control clicks
                const zoomInBtn = chart.shadowRoot.querySelector('[data-action="zoom-in"]');
                assert(zoomInBtn, 'Zoom in button not found');
                
                const prevZoom = chart._zoom.x;
                zoomInBtn.click();
                await new Promise(r => setTimeout(r, 50));
                assert(chart._zoom.x > prevZoom, 'Zoom in not working');
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(10, 'pass');
                passedTests++;
                log('Test 10: Passed - Events working', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(10, 'fail');
                failedTests++;
                log(`Test 10: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 11: Memory Management
        window.runTest11 = async function() {
            totalTests++;
            setTestStatus(11, 'running');
            const resultEl = document.getElementById('result11');
            
            try {
                log('Test 11: Memory Management - Starting', 'info');
                
                // Create and destroy multiple charts
                const charts = [];
                
                for (let i = 0; i < 5; i++) {
                    const chart = document.createElement('brutal-charts');
                    chart.style.height = '300px';
                    document.getElementById('testArea').appendChild(chart);
                    
                    chart.setData([{
                        label: `Memory Test ${i}`,
                        data: Array(100).fill(0).map((_, j) => ({ x: j, y: Math.random() * 100 }))
                    }]);
                    
                    charts.push(chart);
                }
                
                await new Promise(r => setTimeout(r, 500));
                
                // Remove all charts
                charts.forEach(chart => {
                    assert(chart._rafId !== null, 'Animation not running');
                    chart.remove();
                });
                
                await new Promise(r => setTimeout(r, 100));
                
                // Verify cleanup
                charts.forEach(chart => {
                    assert(chart._rafId === null || chart._rafId === undefined, 
                           'Animation not stopped after removal');
                });
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(11, 'pass');
                passedTests++;
                log('Test 11: Passed - Memory properly managed', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(11, 'fail');
                failedTests++;
                log(`Test 11: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Test 12: Edge Cases
        window.runTest12 = async function() {
            totalTests++;
            setTestStatus(12, 'running');
            const resultEl = document.getElementById('result12');
            
            try {
                log('Test 12: Edge Cases - Starting', 'info');
                
                const chart = document.createElement('brutal-charts');
                chart.style.height = '300px';
                document.getElementById('testArea').appendChild(chart);
                
                await new Promise(r => setTimeout(r, 100));
                
                // Test empty data
                chart.setData([]);
                await new Promise(r => setTimeout(r, 100));
                assert(chart._datasets.length === 0, 'Empty data not handled');
                
                // Test invalid data
                chart.setData([{ label: 'Invalid', data: [] }]);
                await new Promise(r => setTimeout(r, 100));
                assert(chart._datasets[0].data.length === 0, 'Empty dataset not handled');
                
                // Test extreme zoom
                chart.zoom(100);
                assert(chart._zoom.x <= 10, 'Zoom limit not enforced');
                
                chart.zoom(0.001);
                assert(chart._zoom.x >= 0.1, 'Zoom minimum not enforced');
                
                // Test invalid chart type
                const prevType = chart._config.type;
                chart.setType('invalid');
                assert(chart._config.type === 'invalid', 'Invalid type not set');
                
                // Should still render without crashing
                await new Promise(r => setTimeout(r, 200));
                
                chart.remove();
                
                resultEl.textContent = '✓ Passed';
                setTestStatus(12, 'pass');
                passedTests++;
                log('Test 12: Passed - Edge cases handled', 'success');
                
            } catch (error) {
                resultEl.textContent = `✗ Failed: ${error.message}`;
                setTestStatus(12, 'fail');
                failedTests++;
                log(`Test 12: Failed - ${error.message}`, 'error');
            }
            
            updateSummary();
        };
        
        // Run all tests
        window.runAllTests = async function() {
            log('Running all tests...', 'warning');
            clearResults();
            
            const tests = [
                runTest1, runTest2, runTest3, runTest4,
                runTest5, runTest6, runTest7, runTest8,
                runTest9, runTest10, runTest11, runTest12
            ];
            
            for (const test of tests) {
                await test();
                await new Promise(r => setTimeout(r, 100));
            }
            
            log(`All tests completed: ${passedTests}/${totalTests} passed`, 
                failedTests === 0 ? 'success' : 'error');
        };
        
        // Clear results
        window.clearResults = function() {
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            
            document.getElementById('testOutput').innerHTML = '';
            document.getElementById('testArea').innerHTML = '';
            
            for (let i = 1; i <= 12; i++) {
                document.getElementById(`status${i}`).className = 'status-indicator';
                document.getElementById(`result${i}`).textContent = '';
            }
            
            updateSummary();
            log('Results cleared', 'info');
        };
        
        // Initial setup
        log('BRUTAL Charts Test Suite Ready', 'success');
        log('Click "Run All Tests" to start comprehensive testing', 'info');
    </script>
</body>
</html>