<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL V3 - Carousel Comprehensive Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui;
            background: #0a0a0a;
            color: #fff;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #00ff00, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #00ff00;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #00cc00;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-output {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
        }
        
        .log-pass {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }
        
        .log-fail {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
        }
        
        .log-info {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
        }
        
        .log-warn {
            background: rgba(255, 255, 0, 0.1);
            color: #ffff00;
        }
        
        /* Test carousel styles */
        .test-carousel {
            height: 300px;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-slide {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
        }
        
        .slide-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .slide-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .slide-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .slide-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .slide-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        
        /* Performance monitor */
        .perf-monitor {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff00;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.85rem;
            min-width: 200px;
            z-index: 9999;
        }
        
        .perf-stat {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .perf-stat .value {
            color: #00ff00;
        }
        
        /* Stress test carousel */
        .stress-carousel {
            height: 200px;
        }
        
        .stress-slide {
            background: linear-gradient(45deg, 
                hsl(var(--hue), 70%, 50%), 
                hsl(calc(var(--hue) + 30), 70%, 50%));
        }
        
        /* Summary */
        .test-summary {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
        }
        
        .test-summary h2 {
            margin-top: 0;
            color: #00ff00;
        }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #00ff00;
        }
        
        .stat-label {
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ§ª BRUTAL Carousel - Comprehensive Test Suite</h1>
        <p>Testing all carousel functionality to ensure 100% reliability</p>
        
        <!-- Performance Monitor -->
        <div class="perf-monitor" id="perfMonitor">
            <h4 style="margin-top: 0; color: #00ff00;">Performance Monitor</h4>
            <div class="perf-stat">
                <span>FPS:</span>
                <span class="value" id="fps">60</span>
            </div>
            <div class="perf-stat">
                <span>Memory:</span>
                <span class="value" id="memory">0 MB</span>
            </div>
            <div class="perf-stat">
                <span>Active Carousels:</span>
                <span class="value" id="activeCarousels">0</span>
            </div>
            <div class="perf-stat">
                <span>Total Slides:</span>
                <span class="value" id="totalSlides">0</span>
            </div>
        </div>
        
        <!-- Test Controls -->
        <div class="test-grid">
            <div class="test-card">
                <h3>ðŸ§ª Automated Test Suite</h3>
                <button onclick="runAllTests()">Run All Tests</button>
                <button onclick="runStressTest()">Run Stress Test</button>
                <button onclick="clearAllLogs()">Clear Logs</button>
            </div>
            
            <div class="test-card">
                <h3>ðŸŽ¯ Functionality Tests</h3>
                <button onclick="testBasicNavigation()">Basic Navigation</button>
                <button onclick="testAutoplay()">Autoplay</button>
                <button onclick="testLoop()">Loop Mode</button>
                <button onclick="testEvents()">Events</button>
            </div>
            
            <div class="test-card">
                <h3>ðŸŽ¨ Effect Tests</h3>
                <button onclick="testAllEffects()">All Effects</button>
                <button onclick="testWebGL()">WebGL Transitions</button>
                <button onclick="testParallax()">Parallax</button>
            </div>
            
            <div class="test-card">
                <h3>ðŸ‘† Interaction Tests</h3>
                <button onclick="testGestures()">Gestures</button>
                <button onclick="testKeyboard()">Keyboard</button>
                <button onclick="testMousewheel()">Mousewheel</button>
                <button onclick="testTouch()">Touch Simulation</button>
            </div>
            
            <div class="test-card">
                <h3>âš¡ Performance Tests</h3>
                <button onclick="testManySlides()">1000 Slides</button>
                <button onclick="testRapidNavigation()">Rapid Navigation</button>
                <button onclick="testMemoryLeaks()">Memory Leaks</button>
                <button onclick="testGPUPerformance()">GPU Performance</button>
            </div>
            
            <div class="test-card">
                <h3>ðŸ”§ Edge Cases</h3>
                <button onclick="testEmptyCarousel()">Empty Carousel</button>
                <button onclick="testSingleSlide()">Single Slide</button>
                <button onclick="testDynamicContent()">Dynamic Content</button>
                <button onclick="testDestruction()">Create/Destroy</button>
            </div>
        </div>
        
        <!-- Test Output -->
        <div class="test-output" id="testOutput">
            <div class="log-entry log-info">Test suite ready. Click any button to start testing.</div>
        </div>
        
        <!-- Test Carousels -->
        <div id="carouselContainer">
            <!-- Basic test carousel -->
            <brutal-carousel id="testCarousel" class="test-carousel">
                <div class="test-slide slide-1">Slide 1</div>
                <div class="test-slide slide-2">Slide 2</div>
                <div class="test-slide slide-3">Slide 3</div>
                <div class="test-slide slide-4">Slide 4</div>
                <div class="test-slide slide-5">Slide 5</div>
            </brutal-carousel>
        </div>
        
        <!-- Test Summary -->
        <div class="test-summary" id="testSummary" style="display: none;">
            <h2>Test Results Summary</h2>
            <div class="summary-stats">
                <div class="stat-box">
                    <div class="stat-number" id="passedTests">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="successRate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { Carousel } from './04-components/ui/Carousel.js';
        
        // Test state
        let testResults = { passed: 0, failed: 0, total: 0 };
        let activeTests = new Set();
        
        // Logging
        function log(message, type = 'info') {
            const output = document.getElementById('testOutput');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
            
            // Update test results
            if (type === 'pass') {
                testResults.passed++;
                testResults.total++;
            } else if (type === 'fail') {
                testResults.failed++;
                testResults.total++;
            }
        }
        
        function assert(condition, message) {
            if (condition) {
                log(`âœ“ ${message}`, 'pass');
                return true;
            } else {
                log(`âœ— ${message}`, 'fail');
                return false;
            }
        }
        
        window.clearAllLogs = function() {
            document.getElementById('testOutput').innerHTML = '';
            testResults = { passed: 0, failed: 0, total: 0 };
        };
        
        // Performance monitoring
        let perfStats = {
            fps: 60,
            memory: 0,
            activeCarousels: 0,
            totalSlides: 0
        };
        
        function updatePerfMonitor() {
            // Count carousels and slides
            const carousels = document.querySelectorAll('brutal-carousel');
            perfStats.activeCarousels = carousels.length;
            perfStats.totalSlides = Array.from(carousels).reduce((sum, c) => sum + c.children.length, 0);
            
            // Update display
            document.getElementById('fps').textContent = perfStats.fps.toFixed(1);
            document.getElementById('memory').textContent = 
                performance.memory ? 
                (performance.memory.usedJSHeapSize / 1048576).toFixed(1) + ' MB' : 
                'N/A';
            document.getElementById('activeCarousels').textContent = perfStats.activeCarousels;
            document.getElementById('totalSlides').textContent = perfStats.totalSlides;
        }
        
        // FPS calculation
        let lastTime = performance.now();
        let frames = 0;
        
        function calculateFPS() {
            frames++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
                perfStats.fps = (frames * 1000) / (currentTime - lastTime);
                frames = 0;
                lastTime = currentTime;
            }
            requestAnimationFrame(calculateFPS);
        }
        calculateFPS();
        
        // Update performance monitor every 100ms
        setInterval(updatePerfMonitor, 100);
        
        // Test functions
        window.testBasicNavigation = async function() {
            log('Testing basic navigation...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                // Test initial state
                assert(carousel.currentIndex === 0, 'Initial index is 0');
                assert(carousel.totalSlides === 5, 'Total slides is 5');
                
                // Test next()
                await carousel.next();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 1, 'Next() moves to index 1');
                
                // Test previous()
                await carousel.previous();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 0, 'Previous() moves back to index 0');
                
                // Test goTo()
                await carousel.goTo(3);
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 3, 'GoTo(3) moves to index 3');
                
                // Test goTo with immediate
                carousel.goTo(0, true);
                assert(carousel.currentIndex === 0, 'GoTo(0, true) moves immediately');
                
                // Test boundary conditions
                await carousel.goTo(-1);
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 4 || carousel.currentIndex === 0, 'Negative index handled');
                
                await carousel.goTo(10);
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 0 || carousel.currentIndex === 4, 'Out of bounds index handled');
                
                log('Basic navigation test completed', 'info');
                
            } catch (error) {
                log(`Navigation test error: ${error.message}`, 'fail');
            }
        };
        
        window.testAutoplay = async function() {
            log('Testing autoplay functionality...', 'info');
            
            const carousel = document.createElement('brutal-carousel');
            carousel.setAttribute('autoplay', 'true');
            carousel.setAttribute('autoplay-delay', '1000');
            carousel.innerHTML = `
                <div class="test-slide slide-1">Auto 1</div>
                <div class="test-slide slide-2">Auto 2</div>
                <div class="test-slide slide-3">Auto 3</div>
            `;
            document.getElementById('carouselContainer').appendChild(carousel);
            
            try {
                // Wait for autoplay
                const startIndex = carousel.currentIndex;
                await new Promise(r => setTimeout(r, 1200));
                assert(carousel.currentIndex > startIndex, 'Autoplay advances slides');
                
                // Test pause
                carousel.pause();
                const pausedIndex = carousel.currentIndex;
                await new Promise(r => setTimeout(r, 1200));
                assert(carousel.currentIndex === pausedIndex, 'Pause stops autoplay');
                
                // Test play
                carousel.play();
                await new Promise(r => setTimeout(r, 1200));
                assert(carousel.currentIndex > pausedIndex, 'Play resumes autoplay');
                
                log('Autoplay test completed', 'info');
                
            } catch (error) {
                log(`Autoplay test error: ${error.message}`, 'fail');
            } finally {
                carousel.remove();
            }
        };
        
        window.testLoop = async function() {
            log('Testing loop mode...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                // Enable loop
                carousel.setAttribute('loop', 'true');
                
                // Test forward loop
                await carousel.goTo(4);
                await carousel.next();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 0, 'Forward loop works');
                
                // Test backward loop
                await carousel.previous();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 4, 'Backward loop works');
                
                // Disable loop
                carousel.removeAttribute('loop');
                await carousel.goTo(4);
                await carousel.next();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 4, 'Non-loop stops at end');
                
                await carousel.goTo(0);
                await carousel.previous();
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === 0, 'Non-loop stops at start');
                
                log('Loop mode test completed', 'info');
                
            } catch (error) {
                log(`Loop test error: ${error.message}`, 'fail');
            }
        };
        
        window.testEvents = async function() {
            log('Testing events...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            let beforeChangeFired = false;
            let afterChangeFired = false;
            let dragStartFired = false;
            let dragEndFired = false;
            
            const beforeChangeHandler = (e) => {
                beforeChangeFired = true;
                log(`BeforeChange event: from ${e.detail.from} to ${e.detail.to}`, 'info');
            };
            
            const afterChangeHandler = (e) => {
                afterChangeFired = true;
                log(`AfterChange event: from ${e.detail.from} to ${e.detail.to}`, 'info');
            };
            
            carousel.addEventListener('beforeChange', beforeChangeHandler);
            carousel.addEventListener('afterChange', afterChangeHandler);
            
            try {
                // Test change events
                await carousel.next();
                await new Promise(r => setTimeout(r, 500));
                
                assert(beforeChangeFired, 'BeforeChange event fired');
                assert(afterChangeFired, 'AfterChange event fired');
                
                log('Events test completed', 'info');
                
            } catch (error) {
                log(`Events test error: ${error.message}`, 'fail');
            } finally {
                carousel.removeEventListener('beforeChange', beforeChangeHandler);
                carousel.removeEventListener('afterChange', afterChangeHandler);
            }
        };
        
        window.testAllEffects = async function() {
            log('Testing all transition effects...', 'info');
            
            const effects = ['slide', 'fade', 'cube', 'coverflow', 'flip'];
            const carousel = document.getElementById('testCarousel');
            
            try {
                for (const effect of effects) {
                    carousel.setAttribute('effect', effect);
                    log(`Testing ${effect} effect...`, 'info');
                    
                    await carousel.goTo(0);
                    await carousel.next();
                    await new Promise(r => setTimeout(r, 600));
                    
                    assert(carousel.currentIndex === 1, `${effect} effect navigation works`);
                }
                
                log('Effects test completed', 'info');
                
            } catch (error) {
                log(`Effects test error: ${error.message}`, 'fail');
            }
        };
        
        window.testGestures = async function() {
            log('Testing gesture support...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                // Check if gesture system is initialized
                const track = carousel.shadowRoot.querySelector('.carousel-track');
                assert(track !== null, 'Carousel track exists');
                
                // Simulate pan gesture
                const startEvent = new PointerEvent('pointerdown', {
                    clientX: 100,
                    clientY: 100,
                    bubbles: true
                });
                
                const moveEvent = new PointerEvent('pointermove', {
                    clientX: 300,
                    clientY: 100,
                    bubbles: true
                });
                
                const endEvent = new PointerEvent('pointerup', {
                    clientX: 300,
                    clientY: 100,
                    bubbles: true
                });
                
                track.dispatchEvent(startEvent);
                track.dispatchEvent(moveEvent);
                track.dispatchEvent(endEvent);
                
                log('Gesture simulation completed', 'info');
                
            } catch (error) {
                log(`Gesture test error: ${error.message}`, 'fail');
            }
        };
        
        window.testKeyboard = async function() {
            log('Testing keyboard navigation...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                carousel.setAttribute('keyboard', 'true');
                const startIndex = carousel.currentIndex;
                
                // Test arrow right
                document.dispatchEvent(new KeyboardEvent('keydown', {
                    key: 'ArrowRight',
                    bubbles: true
                }));
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === startIndex + 1, 'Arrow right advances slide');
                
                // Test arrow left
                document.dispatchEvent(new KeyboardEvent('keydown', {
                    key: 'ArrowLeft',
                    bubbles: true
                }));
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === startIndex, 'Arrow left goes back');
                
                log('Keyboard test completed', 'info');
                
            } catch (error) {
                log(`Keyboard test error: ${error.message}`, 'fail');
            }
        };
        
        window.testManySlides = async function() {
            log('Testing performance with 1000 slides...', 'info');
            
            const carousel = document.createElement('brutal-carousel');
            carousel.className = 'stress-carousel';
            
            try {
                // Create 1000 slides
                for (let i = 0; i < 1000; i++) {
                    const slide = document.createElement('div');
                    slide.className = 'test-slide stress-slide';
                    slide.style.setProperty('--hue', i * 360 / 1000);
                    slide.textContent = `Slide ${i + 1}`;
                    carousel.appendChild(slide);
                }
                
                document.getElementById('carouselContainer').appendChild(carousel);
                
                // Test navigation performance
                const navStart = performance.now();
                await carousel.goTo(500);
                const navTime = performance.now() - navStart;
                
                assert(navTime < 100, `Navigation to slide 500 in ${navTime.toFixed(2)}ms (< 100ms)`);
                
                // Test rapid navigation
                const rapidStart = performance.now();
                for (let i = 0; i < 10; i++) {
                    carousel.goTo(Math.floor(Math.random() * 1000), true);
                }
                const rapidTime = performance.now() - rapidStart;
                
                assert(rapidTime < 50, `10 rapid navigations in ${rapidTime.toFixed(2)}ms (< 50ms)`);
                
                log('Many slides test completed', 'info');
                
            } catch (error) {
                log(`Many slides test error: ${error.message}`, 'fail');
            } finally {
                carousel.remove();
            }
        };
        
        window.testMemoryLeaks = async function() {
            log('Testing for memory leaks...', 'info');
            
            const initialMemory = performance.memory?.usedJSHeapSize || 0;
            const carousels = [];
            
            try {
                // Create and destroy multiple carousels
                for (let i = 0; i < 10; i++) {
                    const carousel = document.createElement('brutal-carousel');
                    for (let j = 0; j < 20; j++) {
                        const slide = document.createElement('div');
                        slide.className = 'test-slide';
                        slide.textContent = `Memory test ${j}`;
                        carousel.appendChild(slide);
                    }
                    document.getElementById('carouselContainer').appendChild(carousel);
                    carousels.push(carousel);
                    
                    // Navigate a bit
                    await carousel.next();
                    await carousel.next();
                }
                
                // Remove all carousels
                carousels.forEach(c => c.remove());
                
                // Force garbage collection if available
                if (window.gc) window.gc();
                
                await new Promise(r => setTimeout(r, 1000));
                
                const finalMemory = performance.memory?.usedJSHeapSize || 0;
                const memoryIncrease = (finalMemory - initialMemory) / 1048576;
                
                log(`Memory increase: ${memoryIncrease.toFixed(2)} MB`, 'info');
                assert(memoryIncrease < 10, 'Memory increase is reasonable (< 10MB)');
                
            } catch (error) {
                log(`Memory leak test error: ${error.message}`, 'fail');
            }
        };
        
        window.testEmptyCarousel = async function() {
            log('Testing empty carousel...', 'info');
            
            const carousel = document.createElement('brutal-carousel');
            document.getElementById('carouselContainer').appendChild(carousel);
            
            try {
                assert(carousel.totalSlides === 0, 'Empty carousel has 0 slides');
                assert(carousel.currentIndex === 0, 'Empty carousel index is 0');
                
                // Try navigation
                await carousel.next();
                assert(carousel.currentIndex === 0, 'Navigation in empty carousel does nothing');
                
                log('Empty carousel test completed', 'info');
                
            } catch (error) {
                log(`Empty carousel test error: ${error.message}`, 'fail');
            } finally {
                carousel.remove();
            }
        };
        
        window.testSingleSlide = async function() {
            log('Testing single slide carousel...', 'info');
            
            const carousel = document.createElement('brutal-carousel');
            carousel.innerHTML = '<div class="test-slide">Single Slide</div>';
            document.getElementById('carouselContainer').appendChild(carousel);
            
            try {
                assert(carousel.totalSlides === 1, 'Single slide carousel has 1 slide');
                
                // Try navigation
                await carousel.next();
                assert(carousel.currentIndex === 0, 'Next in single slide stays at 0');
                
                await carousel.previous();
                assert(carousel.currentIndex === 0, 'Previous in single slide stays at 0');
                
                log('Single slide test completed', 'info');
                
            } catch (error) {
                log(`Single slide test error: ${error.message}`, 'fail');
            } finally {
                carousel.remove();
            }
        };
        
        window.testDynamicContent = async function() {
            log('Testing dynamic content addition/removal...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                const initialCount = carousel.totalSlides;
                
                // Add slide
                const newSlide = document.createElement('div');
                newSlide.className = 'test-slide slide-1';
                newSlide.textContent = 'Dynamic Slide';
                carousel.appendChild(newSlide);
                
                // Re-initialize may be needed
                carousel._initialize?.();
                
                assert(carousel.totalSlides === initialCount + 1, 'Slide added successfully');
                
                // Remove slide
                newSlide.remove();
                carousel._initialize?.();
                
                assert(carousel.totalSlides === initialCount, 'Slide removed successfully');
                
                log('Dynamic content test completed', 'info');
                
            } catch (error) {
                log(`Dynamic content test error: ${error.message}`, 'fail');
            }
        };
        
        window.runStressTest = async function() {
            log('Starting stress test...', 'warn');
            
            try {
                // Create multiple carousels
                const container = document.getElementById('carouselContainer');
                const stressCarousels = [];
                
                for (let i = 0; i < 5; i++) {
                    const carousel = document.createElement('brutal-carousel');
                    carousel.className = 'stress-carousel';
                    carousel.setAttribute('autoplay', 'true');
                    carousel.setAttribute('autoplay-delay', Math.random() * 2000 + 1000);
                    
                    for (let j = 0; j < 50; j++) {
                        const slide = document.createElement('div');
                        slide.className = 'test-slide stress-slide';
                        slide.style.setProperty('--hue', Math.random() * 360);
                        slide.textContent = `Stress ${i}-${j}`;
                        carousel.appendChild(slide);
                    }
                    
                    container.appendChild(carousel);
                    stressCarousels.push(carousel);
                }
                
                // Rapid random navigation
                const interval = setInterval(() => {
                    stressCarousels.forEach(carousel => {
                        if (Math.random() > 0.5) {
                            carousel.goTo(Math.floor(Math.random() * 50), true);
                        }
                    });
                }, 100);
                
                // Run for 5 seconds
                await new Promise(r => setTimeout(r, 5000));
                clearInterval(interval);
                
                // Check FPS
                assert(perfStats.fps > 30, `FPS maintained above 30 (${perfStats.fps.toFixed(1)})`);
                
                // Cleanup
                stressCarousels.forEach(c => c.remove());
                
                log('Stress test completed', 'info');
                
            } catch (error) {
                log(`Stress test error: ${error.message}`, 'fail');
            }
        };
        
        window.runAllTests = async function() {
            clearAllLogs();
            log('Starting comprehensive test suite...', 'warn');
            
            const startTime = performance.now();
            
            // Run all tests
            await testBasicNavigation();
            await testAutoplay();
            await testLoop();
            await testEvents();
            await testAllEffects();
            await testGestures();
            await testKeyboard();
            await testManySlides();
            await testMemoryLeaks();
            await testEmptyCarousel();
            await testSingleSlide();
            await testDynamicContent();
            await runStressTest();
            
            const totalTime = ((performance.now() - startTime) / 1000).toFixed(2);
            
            // Show summary
            document.getElementById('testSummary').style.display = 'block';
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('successRate').textContent = 
                testResults.total > 0 ? 
                Math.round((testResults.passed / testResults.total) * 100) + '%' : 
                '0%';
            
            log(`All tests completed in ${totalTime}s`, 'warn');
            log(`Results: ${testResults.passed} passed, ${testResults.failed} failed`, 
                testResults.failed === 0 ? 'pass' : 'fail');
        };
        
        // Additional test utilities
        window.testWebGL = async function() {
            log('Testing WebGL transitions...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                // Check WebGL support
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl2') || canvas.getContext('webgl');
                
                if (gl) {
                    log('WebGL is supported', 'pass');
                    
                    // Test WebGL effects
                    carousel.setAttribute('effect', 'cube');
                    carousel._config.webglTransitions = true;
                    
                    await carousel.next();
                    await new Promise(r => setTimeout(r, 1000));
                    
                    assert(true, 'WebGL transition completed');
                } else {
                    log('WebGL not supported in this browser', 'warn');
                }
                
            } catch (error) {
                log(`WebGL test error: ${error.message}`, 'fail');
            }
        };
        
        window.testParallax = async function() {
            log('Testing parallax effects...', 'info');
            
            const carousel = document.createElement('brutal-carousel');
            carousel.setAttribute('parallax', 'true');
            carousel.innerHTML = `
                <div class="test-slide">
                    <div data-parallax="0.5">Background Layer</div>
                    <div>Normal Layer</div>
                    <div data-parallax="-0.3">Foreground Layer</div>
                </div>
                <div class="test-slide">
                    <div data-parallax="0.8">Slow Parallax</div>
                </div>
            `;
            
            document.getElementById('carouselContainer').appendChild(carousel);
            
            try {
                await carousel.next();
                await new Promise(r => setTimeout(r, 500));
                
                const parallaxElements = carousel.querySelectorAll('[data-parallax]');
                assert(parallaxElements.length > 0, 'Parallax elements found');
                
                log('Parallax test completed', 'info');
                
            } catch (error) {
                log(`Parallax test error: ${error.message}`, 'fail');
            } finally {
                carousel.remove();
            }
        };
        
        window.testMousewheel = async function() {
            log('Testing mousewheel navigation...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                carousel.setAttribute('mousewheel', 'true');
                const startIndex = carousel.currentIndex;
                
                // Simulate wheel down
                carousel.dispatchEvent(new WheelEvent('wheel', {
                    deltaY: 100,
                    bubbles: true
                }));
                
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex > startIndex, 'Wheel down advances slide');
                
                // Simulate wheel up
                carousel.dispatchEvent(new WheelEvent('wheel', {
                    deltaY: -100,
                    bubbles: true
                }));
                
                await new Promise(r => setTimeout(r, 400));
                assert(carousel.currentIndex === startIndex, 'Wheel up goes back');
                
                carousel.removeAttribute('mousewheel');
                log('Mousewheel test completed', 'info');
                
            } catch (error) {
                log(`Mousewheel test error: ${error.message}`, 'fail');
            }
        };
        
        window.testTouch = async function() {
            log('Testing touch simulation...', 'info');
            const carousel = document.getElementById('testCarousel');
            
            try {
                const track = carousel.shadowRoot.querySelector('.carousel-track');
                const startIndex = carousel.currentIndex;
                
                // Simulate touch swipe
                const touchStart = new TouchEvent('touchstart', {
                    touches: [{ clientX: 300, clientY: 150 }],
                    bubbles: true
                });
                
                const touchMove = new TouchEvent('touchmove', {
                    touches: [{ clientX: 100, clientY: 150 }],
                    bubbles: true
                });
                
                const touchEnd = new TouchEvent('touchend', {
                    changedTouches: [{ clientX: 100, clientY: 150 }],
                    bubbles: true
                });
                
                track.dispatchEvent(touchStart);
                track.dispatchEvent(touchMove);
                track.dispatchEvent(touchEnd);
                
                await new Promise(r => setTimeout(r, 500));
                
                log('Touch simulation completed', 'info');
                
            } catch (error) {
                log(`Touch test error: ${error.message}`, 'fail');
            }
        };
        
        window.testGPUPerformance = async function() {
            log('Testing GPU performance...', 'info');
            
            const carousel = document.getElementById('testCarousel');
            
            try {
                // Enable GPU acceleration
                carousel._config.gpuAcceleration = true;
                
                // Measure frame times
                const frameTimes = [];
                let frameCount = 0;
                
                const measureFrame = (timestamp) => {
                    if (frameCount > 0) {
                        frameTimes.push(timestamp);
                    }
                    frameCount++;
                    
                    if (frameCount < 60) {
                        requestAnimationFrame(measureFrame);
                    }
                };
                
                // Start measurement during animation
                requestAnimationFrame(measureFrame);
                await carousel.next();
                
                await new Promise(r => setTimeout(r, 1000));
                
                // Calculate average frame time
                if (frameTimes.length > 1) {
                    let totalDelta = 0;
                    for (let i = 1; i < frameTimes.length; i++) {
                        totalDelta += frameTimes[i] - frameTimes[i-1];
                    }
                    const avgFrameTime = totalDelta / (frameTimes.length - 1);
                    const avgFPS = 1000 / avgFrameTime;
                    
                    assert(avgFPS > 50, `GPU performance: ${avgFPS.toFixed(1)} FPS (> 50)`);
                }
                
                log('GPU performance test completed', 'info');
                
            } catch (error) {
                log(`GPU performance test error: ${error.message}`, 'fail');
            }
        };
        
        window.testDestruction = async function() {
            log('Testing carousel creation and destruction...', 'info');
            
            try {
                const container = document.getElementById('carouselContainer');
                
                // Create and destroy rapidly
                for (let i = 0; i < 10; i++) {
                    const carousel = document.createElement('brutal-carousel');
                    carousel.innerHTML = `
                        <div class="test-slide">Test 1</div>
                        <div class="test-slide">Test 2</div>
                    `;
                    
                    container.appendChild(carousel);
                    
                    // Use it briefly
                    await carousel.next();
                    
                    // Remove immediately
                    carousel.remove();
                }
                
                // Check for lingering event listeners or timers
                assert(true, 'Rapid creation/destruction completed without errors');
                
                log('Destruction test completed', 'info');
                
            } catch (error) {
                log(`Destruction test error: ${error.message}`, 'fail');
            }
        };
        
        // Initial message
        log('BRUTAL Carousel Comprehensive Test Suite loaded', 'info');
        log('Click "Run All Tests" to start comprehensive testing', 'info');
    </script>
</body>
</html>